<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="/_sdk/data_sdk.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&amp;display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1b263b 100%);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-item:hover {
            background: rgba(45, 212, 191, 0.15);
            transform: translateX(-5px);
        }
        
        .sidebar-item.active {
            background: linear-gradient(90deg, rgba(45, 212, 191, 0.2) 0%, transparent 100%);
            border-right: 3px solid #2dd4bf;
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(45, 212, 191, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(45, 212, 191, 0.3);
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: #2dd4bf;
            box-shadow: 0 0 20px rgba(45, 212, 191, 0.2);
        }
        
        .schedule-cell {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .lecture-card {
            animation: fadeInUp 0.5s ease forwards;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(45, 212, 191, 0.3);
            border-radius: 3px;
        }
        
        .toast {
            animation: slideIn 0.3s ease forwards;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(45, 212, 191, 0.3);
            border: none;
            outline: none;
        }

        .menu-toggle:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 40px rgba(45, 212, 191, 0.4);
        }

        .menu-toggle span {
            display: block;
            width: 24px;
            height: 2px;
            background: white;
            transition: all 0.3s ease;
            position: relative;
        }

        .menu-toggle span:before,
        .menu-toggle span:after {
            content: '';
            position: absolute;
            width: 24px;
            height: 2px;
            background: white;
            transition: all 0.3s ease;
        }

        .menu-toggle span:before {
            top: -8px;
        }

        .menu-toggle span:after {
            bottom: -8px;
        }

        .menu-toggle.open span {
            background: transparent;
        }

        .menu-toggle.open span:before {
            top: 0;
            transform: rotate(45deg);
        }

        .menu-toggle.open span:after {
            bottom: 0;
            transform: rotate(-45deg);
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        #sidebar {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
            z-index: 999;
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            #sidebar {
                position: fixed;
                height: 100vh;
                transform: translateX(100%);
                opacity: 0;
            }
            
            #sidebar.visible {
                transform: translateX(0);
                opacity: 1;
            }
            
            .menu-toggle {
                display: flex;
            }
            
            /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
            body.sidebar-open {
                overflow: hidden;
            }
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        @media (min-width: 769px) {
            .menu-toggle {
                display: none;
            }
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ¹ØªÙŠÙ… Ù„Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 998;
        }

        .sidebar-overlay.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
    <style>@view-transition { navigation: auto; }</style>
</head>
<body class="h-full gradient-bg text-white overflow-auto">
    <div id="app" class="h-full w-full">
        <!-- Login Page -->
        <div id="login-page" class="min-h-full flex items-center justify-center p-4">
            <div class="glass-card rounded-3xl p-8 w-full max-w-md">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-teal-400 to-teal-600 flex items-center justify-center">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                    </div>
                    <h1 id="system-title" class="text-2xl font-bold mb-2">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</h1>
                    <p id="welcome-text" class="text-gray-400">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                </div>
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <select id="user-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                            <option value="student">Ø·Ø§Ù„Ø¨</option>
                            <option value="doctor">Ø¯ÙƒØªÙˆØ±</option>
                            <option value="admin">Ø¹Ù…Ø§Ø¯Ø©</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="login-email" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" placeholder="example@university.edu">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="login-password" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                </div>
                <button onclick="handleLogin()" class="btn-primary w-full py-3 rounded-xl font-bold text-white mb-4">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <div class="text-center">
                    <button onclick="showRegister()" class="text-teal-400 hover:text-teal-300 text-sm">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
                </div>
            </div>
        </div>

        <!-- Register Page -->
        <div id="register-page" class="min-h-full flex items-center justify-center p-4 hidden">
            <div class="glass-card rounded-3xl p-8 w-full max-w-md">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-2">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                    <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ØªØ³Ø¬ÙŠÙ„</p>
                </div>
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                        <select id="register-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" onchange="updateRegisterForm()">
                            <option value="student">Ø·Ø§Ù„Ø¨</option>
                            <option value="doctor">Ø¯ÙƒØªÙˆØ±</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="register-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="register-email" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" placeholder="example@university.edu">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="register-password" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <div id="specialization-field">
    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ØªØ®ØµØµ</label>
    <select id="register-specialization" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" onchange="updateGroupOptions()">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
    </select>
</div>
<div id="group-field">
    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label>
    <select id="register-group" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
    </select>
</div>
                <button onclick="handleRegister()" class="btn-primary w-full py-3 rounded-xl font-bold text-white mb-4">ØªØ³Ø¬ÙŠÙ„</button>
                <div class="text-center">
                    <button onclick="showLogin()" class="text-teal-400 hover:text-teal-300 text-sm">Ù„Ø¯ÙŠ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Container -->
        <div id="dashboard" class="h-full hidden">
            <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© -->
            <button id="menu-toggle" class="menu-toggle" onclick="toggleSidebar()">
                <span></span>
            </button>
            
            <div class="flex h-full">
                <!-- Sidebar -->
                <aside id="sidebar" class="w-72 glass-card border-l border-white/10 flex flex-col">
                    <div class="p-6 border-b border-white/10">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-teal-400 to-teal-600 flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="font-bold text-lg">LMS</h2>
                                <p id="user-role-display" class="text-xs text-gray-400">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</p>
                            </div>
                        </div>
                    </div>
                    <nav id="sidebar-nav" class="flex-1 p-4 space-y-2 overflow-auto">
                        <!-- Navigation items will be inserted here -->
                    </nav>
                    <div class="p-4 border-t border-white/10">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                                <span id="user-avatar" class="font-bold">Ù…</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p id="user-name-display" class="font-medium truncate">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
                                <p id="user-email-display" class="text-xs text-gray-400 truncate">email@example.com</p>
                            </div>
                        </div>
                        <button onclick="handleLogout()" class="w-full py-2 px-4 rounded-xl bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-all flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </aside>

                <!-- Main Content -->
                <main class="flex-1 overflow-auto">
                    <div id="main-content" class="p-6">
                        <!-- Content will be loaded here -->
                    </div>
                </main>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container" class="fixed top-4 left-4 z-50 space-y-2"></div>

        <!-- Modal Container -->
        <div id="modal-container" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div id="modal-content" class="glass-card rounded-2xl p-6 w-full max-w-lg max-h-[90%] overflow-auto">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
        
        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay" class="sidebar-overlay" onclick="hideSidebar()"></div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB3U2bt-PuZlUOb0uRPI1aPxL01Yg8lrts",
            authDomain: "universityti-d2e74.firebaseapp.com",
            projectId: "universityti-d2e74",
            storageBucket: "universityti-d2e74.firebasestorage.app",
            messagingSenderId: "205897642006",
            appId: "1:205897642006:web:d63e9753006d55f0b84537",
            measurementId: "G-6JHV42GV0H"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let firebaseApp, auth, db;
        
        // Default configuration
        const defaultConfig = {
            background_color: '#0d1b2a',
            surface_color: '#1e3a5f',
            text_color: '#ffffff',
            primary_action: '#2dd4bf',
            secondary_action: '#14b8a6',
            font_family: 'Tajawal',
            font_size: 16,
            system_title: 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©',
            welcome_message: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…'
        };

        let config = { ...defaultConfig };
        let allData = [];
        let currentUser = null;
        let currentView = 'dashboard';
        let recordCount = 0;

        // Data Handler
        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                recordCount = data.length;
                updateUI();
            }
        };
// =============================================
// Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª - Ø£Ø¶Ù Ù‚Ø¨Ù„ initializeApp Ù…Ø¨Ø§Ø´Ø±Ø©
// =============================================

function showAddRoomModal() {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
        </div>
        <form onsubmit="addRoom(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                    <input type="text" id="room-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…Ø«Ù„: Ù‚Ø§Ø¹Ø© 101">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                        <select id="room-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="lecture">Ù‚Ø§Ø¹Ø© Ù…Ø­Ø§Ø¶Ø±Ø§Øª</option>
                            <option value="lab">Ù…Ø¹Ù…Ù„</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø³Ø¹Ø©</label>
                        <input type="number" id="room-capacity" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" min="1" max="200" value="30" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                    <input type="text" id="room-location" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" placeholder="Ù…Ø«Ù„: Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØŒ Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø«Ø§Ù†ÙŠ">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</label>
                    <textarea id="room-equipment" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="2" placeholder="Ù…Ø«Ù„: Ø­ÙˆØ§Ø³ÙŠØ¨ØŒ Ø¨Ø±ÙˆØ¬ÙƒØªØ±ØŒ Ø³Ø¨ÙˆØ±Ø© Ø°ÙƒÙŠØ©"></textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <select id="room-status" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                        <option value="available">Ù…ØªØ§Ø­Ø©</option>
                        <option value="maintenance">ØµÙŠØ§Ù†Ø©</option>
                        <option value="unavailable">ØºÙŠØ± Ù…ØªØ§Ø­Ø©</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addRoom(e) {
    e.preventDefault();
    const name = document.getElementById('room-name').value;
    const type = document.getElementById('room-type').value;
    const capacity = document.getElementById('room-capacity').value;
    const location = document.getElementById('room-location').value;
    const equipment = document.getElementById('room-equipment').value;
    const status = document.getElementById('room-status').value;

    try {
        // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø¬Ù…ÙˆØ¹Ø© rooms ÙÙŠ FirebaseØŒ Ø³Ù†Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© Ø®Ø§ØµØ©
        const docRef = await db.collection('rooms').add({
            name: name,
            type: type,
            capacity: parseInt(capacity),
            location: location || '',
            equipment: equipment || '',
            status: status,
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø§Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'room',
            __backendId: docRef.id,
            name: name,
            type: type,
            capacity: parseInt(capacity),
            location: location || '',
            equipment: equipment || '',
            status: status
        });

        updateUI();
    } catch (error) {
        console.error("Error adding room:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø§Ø¹Ø©: ' + error.message, 'error');
    }
}

async function deleteRoom(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¹Ø©ØŸ')) return;
    
    try {
        await db.collection('rooms').doc(id).delete();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¹Ø©');
        
        allData = allData.filter(d => !(d.type === 'room' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting room:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¹Ø©: ' + error.message, 'error');
    }
}

async function editRoom(id) {
    const room = allData.find(d => d.type === 'room' && d.__backendId === id);
    if (!room) return;
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø©</h2>
            <p class="text-gray-400">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¹Ø©</p>
        </div>
        <form onsubmit="updateRoom(event, '${id}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                    <input type="text" id="edit-room-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="${room.name}" required>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                        <select id="edit-room-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="lecture" ${room.type === 'lecture' ? 'selected' : ''}>Ù‚Ø§Ø¹Ø© Ù…Ø­Ø§Ø¶Ø±Ø§Øª</option>
                            <option value="lab" ${room.type === 'lab' ? 'selected' : ''}>Ù…Ø¹Ù…Ù„</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø³Ø¹Ø©</label>
                        <input type="number" id="edit-room-capacity" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="${room.capacity}" min="1" max="200" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                    <input type="text" id="edit-room-location" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="${room.location || ''}">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</label>
                    <textarea id="edit-room-equipment" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="2">${room.equipment || ''}</textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <select id="edit-room-status" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                        <option value="available" ${room.status === 'available' ? 'selected' : ''}>Ù…ØªØ§Ø­Ø©</option>
                        <option value="maintenance" ${room.status === 'maintenance' ? 'selected' : ''}>ØµÙŠØ§Ù†Ø©</option>
                        <option value="unavailable" ${room.status === 'unavailable' ? 'selected' : ''}>ØºÙŠØ± Ù…ØªØ§Ø­Ø©</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function updateRoom(e, id) {
    e.preventDefault();
    const name = document.getElementById('edit-room-name').value;
    const type = document.getElementById('edit-room-type').value;
    const capacity = document.getElementById('edit-room-capacity').value;
    const location = document.getElementById('edit-room-location').value;
    const equipment = document.getElementById('edit-room-equipment').value;
    const status = document.getElementById('edit-room-status').value;

    try {
        await db.collection('rooms').doc(id).update({
            name: name,
            type: type,
            capacity: parseInt(capacity),
            location: location || '',
            equipment: equipment || '',
            status: status,
            updated_at: new Date().toISOString()
        });

        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        const index = allData.findIndex(d => d.type === 'room' && d.__backendId === id);
        if (index !== -1) {
            allData[index].name = name;
            allData[index].type = type;
            allData[index].capacity = parseInt(capacity);
            allData[index].location = location || '';
            allData[index].equipment = equipment || '';
            allData[index].status = status;
        }

        updateUI();
    } catch (error) {
        console.error("Error updating room:", error);
        showToast('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¹Ø©: ' + error.message, 'error');
    }
}
        // Initialize SDKs
        async function initializeApp() {
            try {
                // Initialize Firebase
                firebaseApp = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                console.log("Firebase initialized successfully");
                
                // Check authentication state
                // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
auth.onAuthStateChanged(async (user) => {
    if (user) {
        console.log("User is signed in:", user.email);
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ØŒ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
        try {
            const userDoc = await db.collection('users').doc(user.uid).get();
            if (userDoc.exists) {
                const userData = userDoc.data();
                currentUser = {
                    id: user.uid,
                    name: userData.name || 'Ù…Ø³ØªØ®Ø¯Ù…',
                    email: user.email,
                    role: userData.role || 'student',
                    specialization_id: userData.specialization_id || '',
                    group_id: userData.group_id || ''
                };
                
                // Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…Ø¨Ø§Ø´Ø±Ø©
                showDashboard();
            }
        } catch (error) {
            console.error("Error loading user data:", error);
        }
    } else {
        console.log("No user is signed in");
        // Ø¹Ø±Ø¶ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('dashboard').classList.add('hidden');
        document.getElementById('login-page').classList.remove('hidden');
    }
});
                
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showToast('ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }

            // Initialize Element SDK
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (newConfig) => {
                        config = { ...defaultConfig, ...newConfig };
                        applyConfig();
                        // Ø¨Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±

// Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
await loadInitialData();
                    },
                    mapToCapabilities: (cfg) => ({
                        recolorables: [
                            {
                                get: () => cfg.background_color || defaultConfig.background_color,
                                set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
                            },
                            {
                                get: () => cfg.surface_color || defaultConfig.surface_color,
                                set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
                            },
                            {
                                get: () => cfg.text_color || defaultConfig.text_color,
                                set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
                            },
                            {
                                get: () => cfg.primary_action || defaultConfig.primary_action,
                                set: (v) => { cfg.primary_action = v; window.elementSdk.setConfig({ primary_action: v }); }
                            },
                            {
                                get: () => cfg.secondary_action || defaultConfig.secondary_action,
                                set: (v) => { cfg.secondary_action = v; window.elementSdk.setConfig({ secondary_action: v }); }
                            }
                        ],
                        borderables: [],
                        fontEditable: {
                            get: () => cfg.font_family || defaultConfig.font_family,
                            set: (v) => { cfg.font_family = v; window.elementSdk.setConfig({ font_family: v }); }
                        },
                        fontSizeable: {
                            get: () => cfg.font_size || defaultConfig.font_size,
                            set: (v) => { cfg.font_size = v; window.elementSdk.setConfig({ font_size: v }); }
                        }
                    }),
                    mapToEditPanelValues: (cfg) => new Map([
                        ['system_title', cfg.system_title || defaultConfig.system_title],
                        ['welcome_message', cfg.welcome_message || defaultConfig.welcome_message]
                    ])
                });
            }

            // Initialize Data SDK
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    showToast('ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                }
            }

            applyConfig();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù…Ù† Firebase
           
// =============================================
// Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù…Ù† Firebase
// =============================================
async function loadInitialData() {
    try {
        console.log("ğŸš€ Ø¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù…Ù† Firebase...");
        
        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª
        console.log("ğŸ“š Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª...");
        const specsSnapshot = await db.collection('specializations').get();
        const specializations = [];
        specsSnapshot.forEach(doc => {
            const data = doc.data();
            specializations.push({
                type: 'specialization',
                __backendId: doc.id,
                name: data.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                description: data.description || '',
                code: data.code || '',
                status: data.status || 'active',
                created_at: data.created_at || new Date().toISOString()
            });
        });
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${specializations.length} ØªØ®ØµØµ`);
        
        // 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª
        console.log("ğŸ« Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª...");
        const roomsSnapshot = await db.collection('rooms').get();
        const rooms = [];
        roomsSnapshot.forEach(doc => {
            const data = doc.data();
            rooms.push({
                type: 'room',
                __backendId: doc.id,
                name: data.name || 'Ù‚Ø§Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…',
                room_type: data.type || data.room_type || 'lecture',
                capacity: data.capacity || 30,
                location: data.location || '',
                equipment: data.equipment || '',
                status: data.status || 'available',
                created_at: data.created_at || new Date().toISOString()
            });
        });
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${rooms.length} Ù‚Ø§Ø¹Ø©`);
        
        // 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
        console.log("ğŸ‘¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª...");
        const groupsSnapshot = await db.collection('groups').get();
        const groups = [];
        groupsSnapshot.forEach(doc => {
            const data = doc.data();
            groups.push({
                type: 'group',
                __backendId: doc.id,
                name: data.name || 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…',
                specialization_id: data.specialization_id || '',
                year: data.year || '1',
                semester: data.semester || '1',
                capacity: data.capacity || 30,
                description: data.description || '',
                created_at: data.created_at || new Date().toISOString()
            });
        });
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${groups.length} Ù…Ø¬Ù…ÙˆØ¹Ø©`);
        
        // 4. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        console.log("ğŸ‘¤ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...");
        const usersSnapshot = await db.collection('users').get();
        const users = [];
        usersSnapshot.forEach(doc => {
            const data = doc.data();
            users.push({
                type: 'user',
                __backendId: doc.id,
                name: data.name || 'Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…',
                email: data.email || '',
                role: data.role || 'student',
                specialization_id: data.specialization_id || '',
                group_id: data.group_id || '',
                phone: data.phone || '',
                status: data.status || 'active',
                created_at: data.created_at || new Date().toISOString()
            });
        });
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${users.length} Ù…Ø³ØªØ®Ø¯Ù…`);
        
        // 5. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª
        console.log("ğŸ“– Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª...");
        const coursesSnapshot = await db.collection('courses').get();
        const courses = [];
        coursesSnapshot.forEach(doc => {
            const data = doc.data();
            courses.push({
                type: 'course',
                __backendId: doc.id,
                name: data.name || 'Ù…Ù‚Ø±Ø± Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…',
                code: data.code || '',
                specialization_id: data.specialization_id || '',
                doctor_id: data.doctor_id || '',
                hours: data.hours || 3,
                credits: data.credits || 3,
                level: data.level || 1,
                course_type: data.course_type || data.type || 'theoretical',
                description: data.description || '',
                created_at: data.created_at || new Date().toISOString()
            });
        });
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${courses.length} Ù…Ù‚Ø±Ø±`);
        
        // 6. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
        console.log("ğŸ“… Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„...");
        const schedulesSnapshot = await db.collection('schedules').get();
        const schedules = [];
        schedulesSnapshot.forEach(doc => {
            const data = doc.data();
            schedules.push({
                type: 'schedule',
                __backendId: doc.id,
                course_id: data.course_id || '',
                group_id: data.group_id || '',
                room_id: data.room_id || '',
                day: data.day || 0,
                start_time: data.start_time || '08:00',
                end_time: data.end_time || '09:30',
                type: data.type || 'theoretical',
                instructor: data.instructor || '',
                created_at: data.created_at || new Date().toISOString()
            });
        });
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${schedules.length} Ø¬Ø¯ÙˆÙ„`);
        
        // 7. Ø¯Ù…Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…ØµÙÙˆÙØ© ÙˆØ§Ø­Ø¯Ø©
        allData = [
            ...specializations,
            ...rooms,
            ...groups,
            ...users,
            ...courses,
            ...schedules
        ];
        
        console.log(`ğŸ‰ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${allData.length} Ø¹Ù†ØµØ± Ø¨ÙŠØ§Ù†Ø§Øª`);
        
        // 8. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        await checkAndCreateDefaultData();
        
        // 9. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        updateUI();
        updateSpecializationOptions();
        
        showToast('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success');
        
    } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
        showToast('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
        
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ø£Ù†Ø´Ø¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
        try {
            await checkAndCreateDefaultData();
        } catch (defaultError) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:", defaultError);
        }
    }
}

// =============================================
// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©: Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
// =============================================
async function checkAndCreateDefaultData() {
    try {
        console.log("ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©...");
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ®ØµØµØ§Øª
        let specializations = allData.filter(d => d.type === 'specialization');
        if (specializations.length === 0) {
            console.log("ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ®ØµØµØ§ØªØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØªØ®ØµØµØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©...");
            
            const defaultSpecializations = [
                { 
                    name: 'Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨', 
                    code: 'CS', 
                    description: 'ØªØ®ØµØµ Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨ ÙˆØ§Ù„Ø¨Ø±Ù…Ø¬Ø©',
                    levels: 8
                },
                { 
                    name: 'Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª', 
                    code: 'SE', 
                    description: 'ØªØ®ØµØµ Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª',
                    levels: 8
                },
                { 
                    name: 'Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 
                    code: 'IS', 
                    description: 'ØªØ®ØµØµ Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
                    levels: 8
                }
            ];
            
            for (const spec of defaultSpecializations) {
                try {
                    const docRef = await db.collection('specializations').add({
                        name: spec.name,
                        code: spec.code,
                        description: spec.description,
                        levels: spec.levels,
                        status: 'active',
                        created_at: new Date().toISOString()
                    });
                    
                    allData.push({
                        type: 'specialization',
                        __backendId: docRef.id,
                        ...spec,
                        status: 'active'
                    });
                } catch (error) {
                    console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØªØ®ØµØµ ${spec.name}:`, error);
                }
            }
            console.log("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªØ®ØµØµØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
            specializations = allData.filter(d => d.type === 'specialization');
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø§Øª
        let rooms = allData.filter(d => d.type === 'room');
        if (rooms.length === 0) {
            console.log("ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¹Ø§ØªØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©...");
            
            const defaultRooms = [
                { 
                    name: 'Ù‚Ø§Ø¹Ø© 101', 
                    type: 'lecture', 
                    capacity: 50, 
                    location: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£ÙˆÙ„',
                    equipment: 'Ø¨Ø±ÙˆØ¬ÙƒØªØ±ØŒ Ø³Ø¨ÙˆØ±Ø© Ø°ÙƒÙŠØ©ØŒ Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†',
                    status: 'available'
                },
                { 
                    name: 'Ù‚Ø§Ø¹Ø© 203', 
                    type: 'lecture', 
                    capacity: 40, 
                    location: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø«Ø§Ù†ÙŠ',
                    equipment: 'Ø¨Ø±ÙˆØ¬ÙƒØªØ±ØŒ Ø³Ø¨ÙˆØ±Ø©',
                    status: 'available'
                },
                { 
                    name: 'Ù…Ø¹Ù…Ù„ 105', 
                    type: 'lab', 
                    capacity: 30, 
                    location: 'Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ - Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£ÙˆÙ„',
                    equipment: 'Ø­ÙˆØ§Ø³ÙŠØ¨ØŒ Ø´Ø¨ÙƒØ© Ø¥Ù†ØªØ±Ù†ØªØŒ Ø¨Ø±ÙˆØ¬ÙƒØªØ±',
                    status: 'available'
                }
            ];
            
            for (const room of defaultRooms) {
                try {
                    const docRef = await db.collection('rooms').add({
                        name: room.name,
                        type: room.type,
                        capacity: room.capacity,
                        location: room.location,
                        equipment: room.equipment,
                        status: room.status,
                        created_at: new Date().toISOString()
                    });
                    
                    allData.push({
                        type: 'room',
                        __backendId: docRef.id,
                        ...room
                    });
                } catch (error) {
                    console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø© ${room.name}:`, error);
                }
            }
            console.log("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
        let groups = allData.filter(d => d.type === 'group');
        if (groups.length === 0 && specializations.length > 0) {
            console.log("ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©...");
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙˆÙ„ ØªØ®ØµØµ Ù…ØªØ§Ø­
            const firstSpec = specializations[0];
            
            const defaultGroups = [
                { 
                    name: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£', 
                    specialization_id: firstSpec.__backendId, 
                    year: '1', 
                    semester: '1',
                    capacity: 30,
                    description: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„ØªØ®ØµØµ'
                },
                { 
                    name: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨', 
                    specialization_id: firstSpec.__backendId, 
                    year: '1', 
                    semester: '1',
                    capacity: 30,
                    description: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙÙŠ Ø§Ù„ØªØ®ØµØµ'
                },
                { 
                    name: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬', 
                    specialization_id: firstSpec.__backendId, 
                    year: '2', 
                    semester: '1',
                    capacity: 30,
                    description: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© ÙÙŠ Ø§Ù„ØªØ®ØµØµ'
                }
            ];
            
            for (const group of defaultGroups) {
                try {
                    const docRef = await db.collection('groups').add({
                        name: group.name,
                        specialization_id: group.specialization_id,
                        year: group.year,
                        semester: group.semester,
                        capacity: group.capacity,
                        description: group.description,
                        created_at: new Date().toISOString()
                    });
                    
                    allData.push({
                        type: 'group',
                        __backendId: docRef.id,
                        ...group
                    });
                } catch (error) {
                    console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© ${group.name}:`, error);
                }
            }
            console.log("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
        }
        
        console.log("âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©");
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        updateUI();
        updateSpecializationOptions();
        
    } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:", error);
    }
}
// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ­Ù‚Ù‚ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯
async function checkAndCreateDefaultData() {
    try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ®ØµØµØ§Øª
        const specializations = allData.filter(d => d.type === 'specialization');
        if (specializations.length === 0) {
            console.log("Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ®ØµØµØ§ØªØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØªØ®ØµØµØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©...");
            
            const defaultSpecializations = [
                { name: 'Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨', code: 'CS', description: 'ØªØ®ØµØµ Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨' },
                { name: 'Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª', code: 'SE', description: 'ØªØ®ØµØµ Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª' },
                { name: 'Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', code: 'IS', description: 'ØªØ®ØµØµ Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª' }
            ];
            
            for (const spec of defaultSpecializations) {
                const docRef = await db.collection('specializations').add({
                    name: spec.name,
                    code: spec.code,
                    description: spec.description,
                    created_at: new Date().toISOString()
                });
                
                allData.push({
                    type: 'specialization',
                    __backendId: docRef.id,
                    ...spec
                });
            }
            console.log("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªØ®ØµØµØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø§Øª
        const rooms = allData.filter(d => d.type === 'room');
        if (rooms.length === 0) {
            console.log("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¹Ø§ØªØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©...");
            
            const defaultRooms = [
                { name: 'Ù‚Ø§Ø¹Ø© 101', type: 'lecture', capacity: 50, location: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', equipment: 'Ø¨Ø±ÙˆØ¬ÙƒØªØ±ØŒ Ø³Ø¨ÙˆØ±Ø©', status: 'available' },
                { name: 'Ù‚Ø§Ø¹Ø© 203', type: 'lecture', capacity: 40, location: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', equipment: 'Ø³Ø¨ÙˆØ±Ø© Ø°ÙƒÙŠØ©', status: 'available' },
                { name: 'Ù…Ø¹Ù…Ù„ 105', type: 'lab', capacity: 30, location: 'Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„', equipment: 'Ø­ÙˆØ§Ø³ÙŠØ¨ØŒ Ø´Ø¨ÙƒØ©', status: 'available' }
            ];
            
            for (const room of defaultRooms) {
                const docRef = await db.collection('rooms').add({
                    name: room.name,
                    type: room.type,
                    capacity: room.capacity,
                    location: room.location,
                    equipment: room.equipment,
                    status: room.status,
                    created_at: new Date().toISOString()
                });
                
                allData.push({
                    type: 'room',
                    __backendId: docRef.id,
                    ...room
                });
            }
            console.log("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
        const groups = allData.filter(d => d.type === 'group');
        if (groups.length === 0 && specializations.length > 0) {
            console.log("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©...");
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙˆÙ„ ØªØ®ØµØµ
            const firstSpec = specializations[0];
            
            const defaultGroups = [
                { name: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£', specialization_id: firstSpec.__backendId, year: '1', semester: '1' },
                { name: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨', specialization_id: firstSpec.__backendId, year: '1', semester: '1' },
                { name: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬', specialization_id: firstSpec.__backendId, year: '2', semester: '1' }
            ];
            
            for (const group of defaultGroups) {
                const docRef = await db.collection('groups').add({
                    name: group.name,
                    specialization_id: group.specialization_id,
                    year: group.year,
                    semester: group.semester,
                    created_at: new Date().toISOString()
                });
                
                allData.push({
                    type: 'group',
                    __backendId: docRef.id,
                    ...group
                });
            }
            console.log("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
        }
        
    } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:", error);
    }
}
                
                // Ø¯Ù…Ø¬ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                allData = allData.filter(d => d.type !== 'specialization');
                specializations.forEach(spec => {
                    allData.push({
                        type: 'specialization',
                        ...spec
                    });
                });
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
                const groupsSnapshot = await db.collection('groups').get();
                const groups = [];
                groupsSnapshot.forEach(doc => {
                    groups.push({
                        __backendId: doc.id,
                        ...doc.data()
                    });
                });
                
                allData = allData.filter(d => d.type !== 'group');
                groups.forEach(group => {
                    allData.push({
                        type: 'group',
                        ...group
                    });
                });
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                const usersSnapshot = await db.collection('users').get();
                const users = [];
                usersSnapshot.forEach(doc => {
                    users.push({
                        __backendId: doc.id,
                        ...doc.data()
                    });
                });
                
                allData = allData.filter(d => d.type !== 'user');
                users.forEach(user => {
                    allData.push({
                        type: 'user',
                        ...user
                    });
                });
                
                updateUI();
                
            } catch (error) {
                console.error("Error loading initial data:", error);
            }
        }

        function applyConfig() {
            const font = config.font_family || defaultConfig.font_family;
            const fontSize = config.font_size || defaultConfig.font_size;
            const bgColor = config.background_color || defaultConfig.background_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action || defaultConfig.primary_action;

            document.body.style.fontFamily = `${font}, sans-serif`;
            document.body.style.fontSize = `${fontSize}px`;
            
            document.getElementById('system-title').textContent = config.system_title || defaultConfig.system_title;
            document.getElementById('welcome-text').textContent = config.welcome_message || defaultConfig.welcome_message;

            document.querySelectorAll('.btn-primary').forEach(btn => {
                btn.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${config.secondary_action || defaultConfig.secondary_action} 100%)`;
            });
        }

        // UI Helpers
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-teal-500/90' : type === 'error' ? 'bg-red-500/90' : 'bg-blue-500/90';
            toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-xl shadow-lg backdrop-blur-sm`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showModal(content) {
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('modal-container').classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('modal-container').classList.add('hidden');
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('menu-toggle');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (window.innerWidth <= 768) {
                if (sidebar.classList.contains('visible')) {
                    hideSidebar();
                } else {
                    showSidebar();
                }
            }
        }

        function showSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('menu-toggle');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.add('visible');
            overlay.classList.add('active');
            toggleBtn.classList.add('open');
            document.body.classList.add('sidebar-open');
        }

        function hideSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('menu-toggle');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.remove('visible');
            overlay.classList.remove('active');
            toggleBtn.classList.remove('open');
            document.body.classList.remove('sidebar-open');
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
        function handleResize() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('menu-toggle');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (window.innerWidth > 768) {
                // Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ø±Ø¦ÙŠØ©
                sidebar.classList.remove('visible');
                if (overlay) overlay.classList.remove('active');
                if (toggleBtn) toggleBtn.classList.remove('open');
                document.body.classList.remove('sidebar-open');
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©)
        function closeSidebarOnClick() {
            const navItems = document.querySelectorAll('#sidebar-nav button, #sidebar button');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            hideSidebar();
                        }, 300);
                    }
                });
            });
        }

        // Navigation
        const adminNav = [
            { id: 'dashboard', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6', label: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' },
            { id: 'specializations', icon: 'M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4', label: 'Ø§Ù„ØªØ®ØµØµØ§Øª' },
            { id: 'doctors', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z', label: 'Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©' },
            { id: 'courses', icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253', label: 'Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª' },
            { id: 'schedules', icon: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z', label: 'Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„' },
            { id: 'groups', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z', label: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª' },
            { id: 'rooms', icon: 'M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4', label: 'Ø§Ù„Ù‚Ø§Ø¹Ø§Øª' },
            { id: 'reports', icon: 'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z', label: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±' }
        ];

        const doctorNav = [
            { id: 'dashboard', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6', label: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' },
            { id: 'my-schedule', icon: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z', label: 'Ø¬Ø¯ÙˆÙ„ÙŠ' },
            { id: 'my-courses', icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253', label: 'Ù…ÙˆØ§Ø¯ÙŠ' },
            { id: 'my-students', icon: 'M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z', label: 'Ø·Ù„Ø§Ø¨ÙŠ' },
            { id: 'attendance', icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4', label: 'Ø§Ù„Ø­Ø¶ÙˆØ±' }
        ];

        const studentNav = [
            { id: 'dashboard', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6', label: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' },
            { id: 'full-schedule', icon: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z', label: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„' },
            { id: 'today-schedule', icon: 'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z', label: 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…' },
            { id: 'my-courses', icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253', label: 'Ù…Ù‚Ø±Ø±Ø§ØªÙŠ' },
            { id: 'my-doctors', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z', label: 'Ø¯ÙƒØ§ØªØ±ØªÙŠ' },
            { id: 'my-attendance', icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4', label: 'Ø­Ø¶ÙˆØ±ÙŠ' }
        ];

        function renderSidebar() {
            const nav = document.getElementById('sidebar-nav');
            let navItems = [];
            
            if (currentUser.role === 'admin') {
                navItems = adminNav;
                document.getElementById('user-role-display').textContent = 'Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…Ø§Ø¯Ø©';
            } else if (currentUser.role === 'doctor') {
                navItems = doctorNav;
                document.getElementById('user-role-display').textContent = 'Ù„ÙˆØ­Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ±';
            } else {
                navItems = studentNav;
                document.getElementById('user-role-display').textContent = 'Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨';
            }

            nav.innerHTML = navItems.map(item => `
                <button onclick="navigateTo('${item.id}')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white ${currentView === item.id ? 'active' : ''}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${item.icon}"/>
                    </svg>
                    <span>${item.label}</span>
                </button>
            `).join('');
        }

        function navigateTo(viewId) {
            currentView = viewId;
            renderSidebar();
            renderContent();
        }

        // Auth Functions with Firebase
        async function handleLogin() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    const userType = document.getElementById('user-type').value;

    if (!email || !password) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        return;
    }

    try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±
        if (userType === 'admin') {
            if (email === 'admin@university.edu' && password === 'admin123') {
                currentUser = {
                    id: 'admin_001',
                    name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    email: email,
                    role: 'admin'
                };
                showDashboard();
                showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', 'success');
                return;
            } else {
                showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Firebase
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        console.log("User signed in:", user.uid);

        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore
        const userDoc = await db.collection('users').doc(user.uid).get();
        
        if (userDoc.exists) {
            const userData = userDoc.data();
            console.log("User data from Firestore:", userData);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const userRole = userData.role?.toLowerCase();
            const requestedRole = userType.toLowerCase();
            
            if (userRole === requestedRole) {
                currentUser = {
                    id: user.uid,
                    name: userData.name || 'Ù…Ø³ØªØ®Ø¯Ù…',
                    email: user.email,
                    role: userRole,
                    specialization_id: userData.specialization_id || '',
                    group_id: userData.group_id || ''
                };
                
                console.log("Current user set:", currentUser);
                showDashboard();
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ${currentUser.name}`, 'success');
            } else {
                showToast('Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚. Ø£Ù†Øª Ù…Ø³Ø¬Ù„ ÙƒÙ€ ' + 
                         (userRole === 'doctor' ? 'Ø¯ÙƒØªÙˆØ±' : 'Ø·Ø§Ù„Ø¨'), 'error');
                await auth.signOut();
            }
        } else {
            showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
            await auth.signOut();
        }
    } catch (error) {
        console.error("Login error details:", error);
        
        // Ø±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£ Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ø§Ù‹
        if (error.code === 'auth/user-not-found') {
            showToast('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        } else if (error.code === 'auth/wrong-password') {
            showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
        } else if (error.code === 'auth/invalid-email') {
            showToast('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
        } else {
            showToast('ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
        }
    }
} 
        async function handleRegister() {
    const type = document.getElementById('register-type').value;
    const name = document.getElementById('register-name').value;
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;
    const specialization = document.getElementById('register-specialization').value;
    const group = document.getElementById('register-group').value;

    console.log("Register data:", { type, name, email, password, specialization, group }); // Ù„Ù„ØªØ´Ø®ÙŠØµ

    if (!name || !email || !password) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
    }

    if (type === 'student') {
        if (!specialization || specialization === "" || specialization === "Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ") {
            showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ®ØµØµ', 'error');
            return;
        }
        if (!group || group === "" || group === "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©") {
            showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', 'error');
            return;
        }
    }

    try {
        // Create user in Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Create user document in Firestore
        await db.collection('users').doc(user.uid).set({
            name: name,
            email: email,
            role: type,
            specialization_id: type === 'student' ? specialization : '',
            group_id: type === 'student' ? group : '',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        showLogin();
    } catch (error) {
        console.error("Registration error:", error);
        if (error.code === 'auth/email-already-in-use') {
            showToast('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
        } else if (error.code === 'auth/weak-password') {
            showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
        } else {
            showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + error.message, 'error');
        }
    }
}

        async function handleLogout() {
            try {
                await auth.signOut();
            } catch (error) {
                console.error("Logout error:", error);
            }
            
            currentUser = null;
            currentView = 'dashboard';
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
        }

        function showLogin() {
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('register-page').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('register-page').classList.remove('hidden');
            updateSpecializationOptions();
        }

        function updateRegisterForm() {
            const type = document.getElementById('register-type').value;
            const specField = document.getElementById('specialization-field');
            const groupField = document.getElementById('group-field');
            
            if (type === 'doctor') {
                specField.classList.add('hidden');
                groupField.classList.add('hidden');
            } else {
                specField.classList.remove('hidden');
                groupField.classList.remove('hidden');
            }
        }

        function updateSpecializationOptions() {
    try {
        const specializations = allData.filter(d => d.type === 'specialization');
        console.log("Specializations found:", specializations); // Ù„Ù„ØªØ´Ø®ÙŠØµ
        
        const select = document.getElementById('register-specialization');
        if (select) {
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>' + 
                specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµØ§Øª
            setTimeout(() => {
                updateGroupOptions();
            }, 100);
        }
    } catch (error) {
        console.error("Error in updateSpecializationOptions:", error);
    }
} 

        function showDashboard() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('register-page').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            document.getElementById('user-name-display').textContent = currentUser.name;
            document.getElementById('user-email-display').textContent = currentUser.email;
            document.getElementById('user-avatar').textContent = currentUser.name.charAt(0);
            
            renderSidebar();
            renderContent();
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
            window.addEventListener('resize', handleResize);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            closeSidebarOnClick();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            handleResize();
        }

        // Content Rendering (Ù…ØªØ¨Ù‚ÙŠ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø·ÙÙŠÙØ©)
        function renderContent() {
            const container = document.getElementById('main-content');
            
            if (currentUser.role === 'admin') {
                renderAdminContent(container);
            } else if (currentUser.role === 'doctor') {
                renderDoctorContent(container);
            } else {
                renderStudentContent(container);
            }
        }

        // Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØµÙŠÙŠØ± ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† SDKs Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

        // Admin Dashboard
        function renderAdminDashboard(container) {
            const specs = allData.filter(d => d.type === 'specialization').length;
            const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor').length;
            const students = allData.filter(d => d.type === 'user' && d.role === 'student').length;
            const courses = allData.filter(d => d.type === 'course').length;
            const rooms = allData.filter(d => d.type === 'room').length;
            const groups = allData.filter(d => d.type === 'group').length;

            container.innerHTML = `
                <div class="mb-8">
                    <h1 class="text-3xl font-bold mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                    <p class="text-gray-400">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                </svg>
                            </div>
                            <span class="text-3xl font-bold">${specs}</span>
                        </div>
                        <h3 class="font-semibold text-lg">Ø§Ù„ØªØ®ØµØµØ§Øª</h3>
                        <p class="text-gray-400 text-sm">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</p>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <span class="text-3xl font-bold">${doctors}</span>
                        </div>
                        <h3 class="font-semibold text-lg">Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</h3>
                        <p class="text-gray-400 text-sm">Ø£Ø¹Ø¶Ø§Ø¡ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³</p>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                                </svg>
                            </div>
                            <span class="text-3xl font-bold">${students}</span>
                        </div>
                        <h3 class="font-semibold text-lg">Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                        <p class="text-gray-400 text-sm">Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                </svg>
                            </div>
                            <span class="text-3xl font-bold">${courses}</span>
                        </div>
                        <h3 class="font-semibold text-lg">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h3>
                        <p class="text-gray-400 text-sm">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-pink-500 to-pink-600 flex items-center justify-center">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                </svg>
                            </div>
                            <span class="text-3xl font-bold">${rooms}</span>
                        </div>
                        <h3 class="font-semibold text-lg">Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</h3>
                        <p class="text-gray-400 text-sm">Ù‚Ø§Ø¹Ø§Øª ÙˆÙ…Ø¹Ø§Ù…Ù„</p>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <span class="text-3xl font-bold">${groups}</span>
                        </div>
                        <h3 class="font-semibold text-lg">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h3>
                        <p class="text-gray-400 text-sm">Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                    </div>
                </div>
                
                <div class="glass-card rounded-2xl p-6">
                    <h2 class="text-xl font-bold mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="navigateTo('specializations')" class="btn-primary py-3 px-4 rounded-xl text-sm font-medium">
                            Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ
                        </button>
                        <button onclick="navigateTo('doctors')" class="btn-primary py-3 px-4 rounded-xl text-sm font-medium">
                            Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ±
                        </button>
                        <button onclick="navigateTo('courses')" class="btn-primary py-3 px-4 rounded-xl text-sm font-medium">
                            Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø±
                        </button>
                        <button onclick="navigateTo('schedules')" class="btn-primary py-3 px-4 rounded-xl text-sm font-medium">
                            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
                        </button>
                    </div>
                </div>
            `;
        }
// Ø¨Ø¹Ø¯ Ø³Ø·Ø± 1070ØŒ Ø£Ø¶Ù Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ:
// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminSpecializations(container) {
    const specializations = allData.filter(d => d.type === 'specialization');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª</h1>
                <button onclick="showAddSpecializationModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${specializations.map(spec => {
                            const courses = allData.filter(d => d.type === 'course' && d.specialization_id === spec.__backendId).length;
                            const groups = allData.filter(d => d.type === 'group' && d.specialization_id === spec.__backendId).length;
                            const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.specialization_id === spec.__backendId).length;
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4 font-medium">${spec.name}</td>
                                    <td class="py-3 px-4">${courses}</td>
                                    <td class="py-3 px-4">${groups}</td>
                                    <td class="py-3 px-4">${students}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400">Ù†Ø´Ø·</span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editSpecialization('${spec.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteSpecialization('${spec.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}
function showAddSpecializationModal() {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
        </div>
        <form onsubmit="addSpecialization(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</label>
                    <input type="text" id="spec-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…Ø«Ù„: Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ÙˆØµÙ Ø§Ù„ØªØ®ØµØµ</label>
                    <textarea id="spec-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„ØªØ®ØµØµ..."></textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</label>
                    <select id="spec-levels" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                        ${[1,2,3,4,5,6,7,8].map(l => `<option value="${l}">${l} Ù…Ø³ØªÙˆÙŠØ§Øª</option>`).join('')}
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addSpecialization(e) {
    e.preventDefault();
    const name = document.getElementById('spec-name').value;
    const description = document.getElementById('spec-description').value;
    const levels = document.getElementById('spec-levels').value;

    try {
        const docRef = await db.collection('specializations').add({
            name: name,
            description: description || '',
            levels: parseInt(levels),
            status: 'active',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        allData.push({
            type: 'specialization',
            __backendId: docRef.id,
            name: name,
            description: description || '',
            levels: parseInt(levels),
            status: 'active'
        });

        updateUI();
    } catch (error) {
        console.error("Error adding specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ', 'error');
    }
}

async function deleteSpecialization(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.')) return;
    
    try {
        await db.collection('specializations').doc(id).delete();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ®ØµØµ');
        
        allData = allData.filter(d => !(d.type === 'specialization' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}
function showAddSpecializationModal() {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
        </div>
        <form onsubmit="addSpecialization(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</label>
                    <input type="text" id="spec-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…Ø«Ù„: Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ÙˆØµÙ Ø§Ù„ØªØ®ØµØµ</label>
                    <textarea id="spec-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„ØªØ®ØµØµ..."></textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</label>
                    <select id="spec-levels" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                        ${[1,2,3,4,5,6,7,8].map(l => `<option value="${l}">${l} Ù…Ø³ØªÙˆÙŠØ§Øª</option>`).join('')}
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addSpecialization(e) {
    e.preventDefault();
    const name = document.getElementById('spec-name').value;
    const description = document.getElementById('spec-description').value;
    const levels = document.getElementById('spec-levels').value;

    try {
        const docRef = await db.collection('specializations').add({
            name: name,
            description: description || '',
            levels: parseInt(levels),
            status: 'active',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'specialization',
            __backendId: docRef.id,
            name: name,
            description: description || '',
            levels: parseInt(levels),
            status: 'active'
        });

        updateUI();
    } catch (error) {
        console.error("Error adding specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ', 'error');
    }
}

async function deleteSpecialization(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.')) return;
    
    try {
        await db.collection('specializations').doc(id).delete();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ®ØµØµ');
        
        allData = allData.filter(d => !(d.type === 'specialization' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}
// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø© (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminDoctors(container) {
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</h1>
                <button onclick="showAddDoctorModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ±
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¹Ø¶Ø§Ø¡ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ù„Ø§Ø³Ù…</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${doctors.map(doctor => {
                            const courses = allData.filter(d => d.type === 'course' && d.doctor_id === doctor.__backendId).length;
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${doctor.name}</td>
                                    <td class="py-3 px-4">${doctor.email}</td>
                                    <td class="py-3 px-4">${doctor.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td class="py-3 px-4">${courses}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400">Ù†Ø´Ø·</span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editDoctor('${doctor.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteDoctor('${doctor.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddDoctorModal() {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ± Ø¬Ø¯ÙŠØ¯</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
        </div>
        <form onsubmit="addDoctor(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="doctor-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="doctor-email" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="doctor-phone" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</label>
                    <input type="text" id="doctor-password" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="doctor123" readonly>
                    <p class="text-xs text-gray-400 mt-1">Ø³ÙŠØªÙ… ØªØºÙŠÙŠØ±Ù‡Ø§ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„</p>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addDoctor(e) {
    e.preventDefault();
    const name = document.getElementById('doctor-name').value;
    const email = document.getElementById('doctor-email').value;
    const phone = document.getElementById('doctor-phone').value;
    const password = document.getElementById('doctor-password').value;

    try {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙÙŠ Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙƒØªÙˆØ± ÙÙŠ Firestore
        await db.collection('users').doc(user.uid).set({
            name: name,
            email: email,
            phone: phone || '',
            role: 'doctor',
            status: 'active',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'user',
            __backendId: user.uid,
            name: name,
            email: email,
            phone: phone || '',
            role: 'doctor',
            status: 'active'
        });

        updateUI();
    } catch (error) {
        console.error("Error adding doctor:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙƒØªÙˆØ±', 'error');
    }
}

async function deleteDoctor(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙƒØªÙˆØ±ØŸ')) return;
    
    try {
        // Ø­Ø°Ù Ù…Ù† Firestore
        await db.collection('users').doc(id).delete();
        
        // Ø­Ø°Ù Ù…Ù† Authentication (ÙŠØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¥Ø¯Ø§Ø±ÙŠØ© ÙÙŠ Firebase)
        // Note: Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø®Ø§ØµØ© ÙÙŠ Firebase
        
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData = allData.filter(d => !(d.type === 'user' && d.__backendId === id && d.role === 'doctor'));
        updateUI();
    } catch (error) {
        console.error("Error deleting doctor:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminCourses(container) {
    const courses = allData.filter(d => d.type === 'course');
    const specializations = allData.filter(d => d.type === 'specialization');
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h1>
                <button onclick="showAddCourseModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø±
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø±Ù…Ø² Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ®ØµØµ</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¯ÙƒØªÙˆØ±</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù†ÙˆØ¹</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${courses.map(course => {
                            const specialization = specializations.find(s => s.__backendId === course.specialization_id);
                            const doctor = doctors.find(d => d.__backendId === course.doctor_id);
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4 font-mono">${course.code || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td class="py-3 px-4">${course.name}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">${course.hours || 0}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                            ${course.course_type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">${course.level || 1}</td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editCourse('${course.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteCourse('${course.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddCourseModal() {
    const specializations = allData.filter(d => d.type === 'specialization');
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
        </div>
        <form onsubmit="addCourse(event)">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø±Ù…Ø² Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                        <input type="text" id="course-code" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                        <input type="text" id="course-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ØªØ®ØµØµ</label>
                        <select id="course-specialization" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
                            ${specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø¯ÙƒØªÙˆØ±</label>
                        <select id="course-doctor" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙƒØªÙˆØ±</option>
                            ${doctors.map(d => `<option value="${d.__backendId}">${d.name}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label>
                        <input type="number" id="course-hours" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" min="1" max="10" value="3" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                        <select id="course-level" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            ${[1,2,3,4,5,6,7,8].map(l => `<option value="${l}">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${l}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                        <select id="course-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="theoretical">Ù†Ø¸Ø±ÙŠ</option>
                            <option value="practical">Ø¹Ù…Ù„ÙŠ</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="course-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3"></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addCourse(e) {
    e.preventDefault();
    const code = document.getElementById('course-code').value;
    const name = document.getElementById('course-name').value;
    const specialization_id = document.getElementById('course-specialization').value;
    const doctor_id = document.getElementById('course-doctor').value;
    const hours = document.getElementById('course-hours').value;
    const level = document.getElementById('course-level').value;
    const course_type = document.getElementById('course-type').value;
    const description = document.getElementById('course-description').value;

    try {
        const docRef = await db.collection('courses').add({
            code: code,
            name: name,
            specialization_id: specialization_id,
            doctor_id: doctor_id,
            hours: parseInt(hours),
            level: parseInt(level),
            course_type: course_type,
            description: description || '',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø±Ø± Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'course',
            __backendId: docRef.id,
            code: code,
            name: name,
            specialization_id: specialization_id,
            doctor_id: doctor_id,
            hours: parseInt(hours),
            level: parseInt(level),
            course_type: course_type,
            description: description || ''
        });

        updateUI();
    } catch (error) {
        console.error("Error adding course:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø±Ø±', 'error');
    }
}

async function deleteCourse(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø±Ø±ØŸ')) return;
    
    try {
        await db.collection('courses').doc(id).delete();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø±Ø±');
        
        allData = allData.filter(d => !(d.type === 'course' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting course:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminSchedules(container) {
    const schedules = allData.filter(d => d.type === 'schedule');
    const courses = allData.filter(d => d.type === 'course');
    const groups = allData.filter(d => d.type === 'group');
    const rooms = allData.filter(d => d.type === 'room');
    const specializations = allData.filter(d => d.type === 'specialization');
    
    const uniqueLevels = [...new Set(courses.map(c => c.level))].sort((a, b) => a - b);
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</h1>
                <div class="flex gap-3">
                    <select id="schedule-specialization" onchange="filterSchedules()" class="input-field px-4 py-3 rounded-xl text-white outline-none w-48">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµØµØ§Øª</option>
                        ${specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('')}
                    </select>
                    <select id="schedule-level" onchange="filterSchedules()" class="input-field px-4 py-3 rounded-xl text-white outline-none w-48">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</option>
                        ${uniqueLevels.map(l => `<option value="${l}">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${l}</option>`).join('')}
                    </select>
                    <button onclick="showAddScheduleModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                        Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø©
                    </button>
                </div>
            </div>
            <p class="text-gray-400 mt-2">Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ®ØµØµ ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰</p>
        </div>
        
        <div id="schedules-container" class="space-y-8">
            <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù‡Ù†Ø§ -->
        </div>
    `;
    
    renderFilteredSchedules();
}

function renderFilteredSchedules() {
    const container = document.getElementById('schedules-container');
    const selectedSpec = document.getElementById('schedule-specialization').value;
    const selectedLevel = document.getElementById('schedule-level').value;
    
    const schedules = allData.filter(d => d.type === 'schedule');
    const courses = allData.filter(d => d.type === 'course');
    const groups = allData.filter(d => d.type === 'group');
    const rooms = allData.filter(d => d.type === 'room');
    const specializations = allData.filter(d => d.type === 'specialization');
    
    const filteredSchedules = schedules.filter(schedule => {
        const course = courses.find(c => c.__backendId === schedule.course_id);
        if (!course) return false;
        
        if (selectedSpec && course.specialization_id !== selectedSpec) return false;
        if (selectedLevel && course.level != selectedLevel) return false;
        
        return true;
    });
    
    if (filteredSchedules.length === 0) {
        container.innerHTML = `
            <div class="glass-card rounded-2xl p-12 text-center">
                <svg class="w-20 h-20 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <h3 class="text-xl font-medium mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h3>
                <p class="text-gray-400">${selectedSpec || selectedLevel ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©' : 'Ù„Ù… ØªØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¨Ø¹Ø¯'}</p>
            </div>
        `;
        return;
    }
    
    const groupedSchedules = {};
    
    filteredSchedules.forEach(schedule => {
        const course = courses.find(c => c.__backendId === schedule.course_id);
        if (!course) return;
        
        const spec = specializations.find(s => s.__backendId === course.specialization_id);
        const key = `${course.specialization_id}_${course.level}`;
        
        if (!groupedSchedules[key]) {
            groupedSchedules[key] = {
                specialization: spec,
                level: course.level,
                schedules: []
            };
        }
        
        groupedSchedules[key].schedules.push(schedule);
    });
    
    container.innerHTML = Object.values(groupedSchedules).map(group => {
        return `
            <div class="glass-card rounded-2xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-bold">${group.specialization ? group.specialization.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} - Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${group.level}</h2>
                        <p class="text-gray-400">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª: ${group.schedules.length}</p>
                    </div>
                    <button onclick="downloadSchedule('${group.specialization ? group.specialization.__backendId : ''}', ${group.level})" class="px-4 py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                        ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    </button>
                </div>
                
                <div class="grid grid-cols-7 gap-4 mb-4">
                    ${['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'].map(day => `
                        <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                    `).join('')}
                </div>
                <div class="grid grid-cols-7 gap-4">
                    ${Array.from({length: 7}, (_, dayIndex) => {
                        const daySchedules = group.schedules.filter(s => s.day === dayIndex);
                        return `
                            <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                                ${daySchedules.map(schedule => {
                                    const course = courses.find(c => c.__backendId === schedule.course_id);
                                    const groupObj = groups.find(g => g.__backendId === schedule.group_id);
                                    const room = rooms.find(r => r.__backendId === schedule.room_id);
                                    return `
                                        <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                            <div class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                            <div class="text-sm text-gray-400">${groupObj ? groupObj.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                            <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                            <div class="text-xs text-gray-500">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                            <div class="flex gap-1 mt-2">
                                                <button onclick="editSchedule('${schedule.__backendId}')" class="text-xs px-2 py-1 rounded bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                    ØªØ¹Ø¯ÙŠÙ„
                                                </button>
                                                <button onclick="deleteSchedule('${schedule.__backendId}')" class="text-xs px-2 py-1 rounded bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                    Ø­Ø°Ù
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    }).join('');
}

function filterSchedules() {
    renderFilteredSchedules();
}

function downloadSchedule(specializationId, level) {
    const specialization = allData.find(d => d.type === 'specialization' && d.__backendId === specializationId);
    showToast(`ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ø¯ÙˆÙ„ ${specialization ? specialization.name : ''} - Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level}`, 'success');
}

function showAddScheduleModal() {
    const courses = allData.filter(d => d.type === 'course');
    const groups = allData.filter(d => d.type === 'group');
    const rooms = allData.filter(d => d.type === 'room');
    const specializations = allData.filter(d => d.type === 'specialization');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <p class="text-gray-400">Ø¬Ø¯ÙˆÙ„Ø© Ù…Ø­Ø§Ø¶Ø±Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
        </div>
        <form onsubmit="addSchedule(event)">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ØªØ®ØµØµ</label>
                        <select id="schedule-specialization-select" onchange="updateCoursesBySpecialization()" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
                            ${specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                        <select id="schedule-level-select" onchange="updateCoursesByLevel()" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</option>
                            ${[1,2,3,4,5,6,7,8].map(l => `<option value="${l}">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${l}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                        <select id="schedule-course" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø±Ø±</option>
                            ${courses.map(c => `<option value="${c.__backendId}" data-spec="${c.specialization_id}" data-level="${c.level}">${c.code} - ${c.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label>
                        <select id="schedule-group" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            ${groups.map(g => `<option value="${g.__backendId}">${g.name}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ÙŠÙˆÙ…</label>
                        <select id="schedule-day" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="0">Ø§Ù„Ø£Ø­Ø¯</option>
                            <option value="1">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
                            <option value="2">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                            <option value="3">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                            <option value="4">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                            <option value="5">Ø§Ù„Ø¬Ù…Ø¹Ø©</option>
                            <option value="6">Ø§Ù„Ø³Ø¨Øª</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                        <select id="schedule-room" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¹Ø©</option>
                            ${rooms.map(r => `<option value="${r.__backendId}">${r.name} (${r.type === 'lecture' ? 'Ù‚Ø§Ø¹Ø©' : 'Ù…Ø¹Ù…Ù„'})</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                        <input type="time" id="schedule-start" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required value="08:00">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                        <input type="time" id="schedule-end" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required value="10:00">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</label>
                    <select id="schedule-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                        <option value="theoretical">Ù†Ø¸Ø±ÙŠ</option>
                        <option value="practical">Ø¹Ù…Ù„ÙŠ</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}
function updateCoursesBySpecialization() {
    const specId = document.getElementById('schedule-specialization-select').value;
    const levelSelect = document.getElementById('schedule-level-select');
    const courseSelect = document.getElementById('schedule-course');
    const courses = allData.filter(d => d.type === 'course');
    
    const levels = [...new Set(courses.filter(c => c.specialization_id === specId).map(c => c.level))].sort((a, b) => a - b);
    
    levelSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</option>' + 
        levels.map(l => `<option value="${l}">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${l}</option>`).join('');
    
    updateCoursesByLevel();
}

function updateCoursesByLevel() {
    const specId = document.getElementById('schedule-specialization-select').value;
    const level = document.getElementById('schedule-level-select').value;
    const courseSelect = document.getElementById('schedule-course');
    const courses = allData.filter(d => d.type === 'course');
    
    let filteredCourses = courses;
    
    if (specId) {
        filteredCourses = filteredCourses.filter(c => c.specialization_id === specId);
    }
    
    if (level) {
        filteredCourses = filteredCourses.filter(c => c.level == level);
    }
    
    courseSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø±Ø±</option>' + 
        filteredCourses.map(c => `<option value="${c.__backendId}">${c.code} - ${c.name}</option>`).join('');
}

async function addSchedule(e) {
    e.preventDefault();
    const course_id = document.getElementById('schedule-course').value;
    const group_id = document.getElementById('schedule-group').value;
    const day = parseInt(document.getElementById('schedule-day').value);
    const room_id = document.getElementById('schedule-room').value;
    const start_time = document.getElementById('schedule-start').value;
    const end_time = document.getElementById('schedule-end').value;
    const type = document.getElementById('schedule-type').value;

    try {
        const docRef = await db.collection('schedules').add({
            course_id: course_id,
            group_id: group_id,
            day: day,
            room_id: room_id,
            start_time: start_time,
            end_time: end_time,
            type: type,
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'schedule',
            __backendId: docRef.id,
            course_id: course_id,
            group_id: group_id,
            day: day,
            room_id: room_id,
            start_time: start_time,
            end_time: end_time,
            type: type
        });

        updateUI();
    } catch (error) {
        console.error("Error adding schedule:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©', 'error');
    }
}

async function deleteSchedule(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŸ')) return;
    
    try {
        await db.collection('schedules').doc(id).delete();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©');
        
        allData = allData.filter(d => !(d.type === 'schedule' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting schedule:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminGroups(container) {
    const groups = allData.filter(d => d.type === 'group');
    const specializations = allData.filter(d => d.type === 'specialization');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h1>
                <button onclick="showAddGroupModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø©
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ®ØµØµ</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø³Ø¹Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${groups.map(group => {
                            const specialization = specializations.find(s => s.__backendId === group.specialization_id);
                            const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.group_id === group.__backendId).length;
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${group.name}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">${students}</td>
                                    <td class="py-3 px-4">${group.capacity || 30}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${students < (group.capacity || 30) ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                                            ${students < (group.capacity || 30) ? 'Ù…ØªØ§Ø­Ø©' : 'Ù…Ù…ØªÙ„Ø¦Ø©'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editGroup('${group.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteGroup('${group.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddGroupModal() {
    const specializations = allData.filter(d => d.type === 'specialization');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
        </div>
        <form onsubmit="addGroup(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label>
                    <input type="text" id="group-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…Ø«Ù„: Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ØªØ®ØµØµ</label>
                        <select id="group-specialization" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
                            ${specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø³Ø¹Ø©</label>
                        <input type="number" id="group-capacity" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" min="1" max="100" value="30" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="group-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="2" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©..."></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addGroup(e) {
    e.preventDefault();
    const name = document.getElementById('group-name').value;
    const specialization_id = document.getElementById('group-specialization').value;
    const capacity = document.getElementById('group-capacity').value;
    const description = document.getElementById('group-description').value;

    try {
        const docRef = await db.collection('groups').add({
            name: name,
            specialization_id: specialization_id,
            capacity: parseInt(capacity),
            description: description || '',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'group',
            __backendId: docRef.id,
            name: name,
            specialization_id: specialization_id,
            capacity: parseInt(capacity),
            description: description || ''
        });

        updateUI();
    } catch (error) {
        console.error("Error adding group:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', 'error');
    }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminRooms(container) {
    const rooms = allData.filter(d => d.type === 'room');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</h1>
                <button onclick="showAddRoomModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø©
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø§Ù…Ù„</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù†ÙˆØ¹</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø³Ø¹Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rooms.map(room => `
                            <tr class="border-b border-white/5 hover:bg-white/5">
                                <td class="py-3 px-4">${room.name}</td>
                                <td class="py-3 px-4">
                                    <span class="px-2 py-1 rounded-full text-xs ${room.type === 'lecture' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                        ${room.type === 'lecture' ? 'Ù‚Ø§Ø¹Ø© Ù…Ø­Ø§Ø¶Ø±Ø§Øª' : 'Ù…Ø¹Ù…Ù„'}
                                    </span>
                                </td>
                                <td class="py-3 px-4">${room.capacity}</td>
                                <td class="py-3 px-4">${room.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                <td class="py-3 px-4">${room.equipment || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                                <td class="py-3 px-4">
                                    <span class="px-2 py-1 rounded-full text-xs ${room.status === 'available' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                                        ${room.status === 'available' ? 'Ù…ØªØ§Ø­Ø©' : 'ØºÙŠØ± Ù…ØªØ§Ø­Ø©'}
                                    </span>
                                </td>
                                <td class="py-3 px-4">
                                    <div class="flex gap-2">
                                        <button onclick="editRoom('${room.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                            ØªØ¹Ø¯ÙŠÙ„
                                        </button>
                                        <button onclick="deleteRoom('${room.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                            Ø­Ø°Ù
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

// ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ±
function renderDoctorDashboard(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const doctorSchedules = allData.filter(d => d.type === 'schedule');
    const today = new Date().getDay(); // 0-6 where 0 is Sunday
    
    const todaySchedules = doctorSchedules.filter(schedule => {
        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
        return course && course.doctor_id === currentUser.id && schedule.day === today;
    });

    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¯ÙƒØªÙˆØ± ${currentUser.name}</h1>
            <p class="text-gray-400">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¯ÙƒØªÙˆØ±</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${doctorCourses.length}</span>
                </div>
                <h3 class="font-semibold text-lg">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h3>
                <p class="text-gray-400 text-sm">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ù†Ø¯Ø© Ø¥Ù„ÙŠÙƒ</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${todaySchedules.length}</span>
                </div>
                <h3 class="font-semibold text-lg">Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                <p class="text-gray-400 text-sm">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ÙŠÙˆÙ…</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">85%</span>
                </div>
                <h3 class="font-semibold text-lg">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                <p class="text-gray-400 text-sm">Ù…ØªÙˆØ³Ø· Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h2>
                <div class="space-y-3">
                    ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                        const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                        const group = allData.find(g => g.type === 'group' && g.__backendId === schedule.group_id);
                        
                        return `
                            <div class="p-3 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</h3>
                                        <p class="text-sm text-gray-400">${group ? group.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} - ${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-medium">${schedule.start_time} - ${schedule.end_time}</div>
                                        <button onclick="takeAttendance('${schedule.__backendId}')" class="mt-2 px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                            ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('') : `
                        <div class="text-center py-8 text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                    `}
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h2>
                <div class="space-y-3">
                    ${doctorCourses.slice(0, 3).map(course => {
                        const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === course.specialization_id);
                        const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.specialization_id === course.specialization_id).length;
                        
                        return `
                            <div class="p-3 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course.name}</h3>
                                        <p class="text-sm text-gray-400">${specialization ? specialization.name : ''} - ${course.code}</p>
                                    </div>
                                    <span class="px-2 py-1 rounded-full text-xs bg-blue-500/20 text-blue-400">
                                        ${course.course_type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                                    </span>
                                </div>
                                <div class="flex items-center justify-between mt-3 text-sm">
                                    <span class="text-gray-400">${students} Ø·Ø§Ù„Ø¨</span>
                                    <span class="text-gray-400">${course.hours} Ø³Ø§Ø¹Ø©</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>
    `;
}

// ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
function renderStudentDashboard(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    const today = new Date().getDay();
    const todaySchedules = studentSchedules.filter(schedule => schedule.day === today);
    const studentCourses = allData.filter(d => d.type === 'course');
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}</h1>
            <p class="text-gray-400">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ø§Ù„Ø¨</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${todaySchedules.length}</span>
                </div>
                <h3 class="font-semibold text-lg">Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                <p class="text-gray-400 text-sm">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ÙŠÙˆÙ…</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${studentCourses.length}</span>
                </div>
                <h3 class="font-semibold text-lg">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h3>
                <p class="text-gray-400 text-sm">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">92%</span>
                </div>
                <h3 class="font-semibold text-lg">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                <p class="text-gray-400 text-sm">Ø­Ø¶ÙˆØ±Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…</h2>
                <div class="space-y-3">
                    ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                        const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                        const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                        
                        return `
                            <div class="p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</h3>
                                        <p class="text-sm text-gray-400">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-medium">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-sm text-gray-400">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                    </div>
                                </div>
                                <div class="mt-3 flex items-center justify-between text-sm">
                                    <span class="px-2 py-1 rounded-full ${schedule.type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                        ${schedule.type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                                    </span>
                                    <button onclick="confirmAttendance('${schedule.__backendId}')" class="px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('') : `
                        <div class="text-center py-8 text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                    `}
                </div>
            </div>
            
            <div class="glasscard rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ®ØµØµ</h2>
                ${(() => {
                    const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === currentUser.specialization_id);
                    const group = allData.find(g => g.type === 'group' && g.__backendId === currentUser.group_id);
                    
                    if (specialization) {
                        return `
                            <div class="space-y-4">
                                <div class="p-4 rounded-lg bg-white/5">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h3 class="font-medium">${specialization.name}</h3>
                                            <p class="text-sm text-gray-400">ØªØ®ØµØµÙƒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</p>
                                        </div>
                                    </div>
                                </div>
                                
                                ${group ? `
                                    <div class="p-4 rounded-lg bg-white/5">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h3 class="font-medium">${group.name}</h3>
                                                <p class="text-sm text-gray-400">Ù…Ø¬Ù…ÙˆØ¹ØªÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                    return '<p class="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ØªØ§Ø­Ø©</p>';
                })()}
            </div>
        </div>
    `;
}

// ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
function takeAttendance(scheduleId) {
    showToast('ØªÙ… ÙØªØ­ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±', 'info');
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ° Ù…Ù†Ø·Ù‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
}

function confirmAttendance(scheduleId) {
    showToast('ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¶ÙˆØ±Ùƒ', 'success');
}
// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª - Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯
function renderAdminSpecializations(container) {
    const specializations = allData.filter(d => d.type === 'specialization');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª</h1>
                <button onclick="showAddSpecializationModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${specializations.map(spec => {
                            const courses = allData.filter(d => d.type === 'course' && d.specialization_id === spec.__backendId).length;
                            const groups = allData.filter(d => d.type === 'group' && d.specialization_id === spec.__backendId).length;
                            const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.specialization_id === spec.__backendId).length;
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4 font-medium">${spec.name}</td>
                                    <td class="py-3 px-4">${courses}</td>
                                    <td class="py-3 px-4">${groups}</td>
                                    <td class="py-3 px-4">${students}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400">Ù†Ø´Ø·</span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editSpecialization('${spec.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteSpecialization('${spec.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}
// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© renderAdminContent
function renderAdminContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderAdminDashboard(container);
            break;
        case 'specializations':
            renderAdminSpecializations(container);
            break;
        case 'doctors':
            renderAdminDoctors(container);
            break;
        case 'courses':
            renderAdminCourses(container);
            break;
        case 'schedules':
            renderAdminSchedules(container);
            break;
        case 'groups':
            renderAdminGroups(container);
            break;
        case 'rooms':
            renderAdminRooms(container);
            break;
        case 'reports':
            renderAdminReports(container);
            break;
        default:
            renderAdminDashboard(container);
    }
} 

function renderAdminReports(container) {
    const specializations = allData.filter(d => d.type === 'specialization').length;
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor').length;
    const students = allData.filter(d => d.type === 'user' && d.role === 'student').length;
    const courses = allData.filter(d => d.type === 'course').length;
    const schedules = allData.filter(d => d.type === 'schedule').length;
    const groups = allData.filter(d => d.type === 'group').length;
    const rooms = allData.filter(d => d.type === 'room').length;
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h1>
            <p class="text-gray-400">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø© Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù…</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµØ§Øª</span>
                        <span class="font-bold">${specializations}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</span>
                        <span class="font-bold">${doctors}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                        <span class="font-bold">${students}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</span>
                        <span class="font-bold">${courses}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span>
                        <span class="font-bold">${groups}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</span>
                        <span class="font-bold">${rooms}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</span>
                        <span class="font-bold">${schedules}</span>
                    </div>
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø¹Ø§Ù…Ø©</span>
                            <span>85%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-teal-500" style="width: 85%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù†Ø¸Ø±ÙŠØ©</span>
                            <span>88%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-500" style="width: 88%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span>
                            <span>82%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-orange-500" style="width: 82%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h3 class="font-medium mb-3">Ø£Ø¹Ù„Ù‰ 5 Ù…Ù‚Ø±Ø±Ø§Øª Ø­Ø¶ÙˆØ±Ø§Ù‹</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                            <span class="text-teal-400">94%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                            <span class="text-teal-400">91%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨</span>
                            <span class="text-teal-400">89%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ø§Ù„Ø´Ø¨ÙƒØ§Øª</span>
                            <span class="text-teal-400">87%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</span>
                            <span class="text-teal-400">85%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© renderDoctorContent
function renderDoctorContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderDoctorDashboard(container);
            break;
        case 'my-schedule':
            renderDoctorSchedule(container);
            break;
        case 'my-courses':
            renderDoctorCourses(container);
            break;
        case 'my-students':
            renderDoctorStudents(container);
            break;
        case 'attendance':
            renderDoctorAttendance(container);
            break;
        default:
            renderDoctorDashboard(container);
    }
}

function renderDoctorSchedule(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const schedules = allData.filter(d => d.type === 'schedule');
    const doctorSchedules = schedules.filter(schedule => {
        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
        return course && course.doctor_id === currentUser.id;
    });
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h1>
            <p class="text-gray-400">Ù…Ø­Ø§Ø¶Ø±Ø§ØªÙŠ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="grid grid-cols-7 gap-4 mb-4">
                ${['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'].map(day => `
                    <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                `).join('')}
            </div>
            <div class="grid grid-cols-7 gap-4">
                ${Array.from({length: 7}, (_, dayIndex) => {
                    const daySchedules = doctorSchedules.filter(s => s.day === dayIndex);
                    return `
                        <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                            ${daySchedules.map(schedule => {
                                const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                                const group = allData.find(g => g.type === 'group' && g.__backendId === schedule.group_id);
                                const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                                return `
                                    <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                        <div class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-sm text-gray-400">${group ? group.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-xs text-gray-500">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <button onclick="takeAttendance('${schedule.__backendId}')" class="w-full mt-2 px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                            ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function renderDoctorCourses(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ù…Ø³Ù†Ø¯Ø© Ø¥Ù„ÙŠ</h1>
            <p class="text-gray-400">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªÙŠ Ø£Ù‚ÙˆÙ… Ø¨ØªØ¯Ø±ÙŠØ³Ù‡Ø§</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${doctorCourses.map(course => {
                const specialization = allData.find(d => d.type === 'specialization' && d.__backendId === course.specialization_id);
                const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.specialization_id === course.specialization_id).length;
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'} flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <span class="text-2xl font-bold">${course.hours || 0}</span>
                        </div>
                        <h3 class="font-semibold text-lg mb-2">${course.name}</h3>
                        <p class="text-gray-400 text-sm mb-4">${specialization ? specialization.name : ''}</p>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">${course.code || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø²'}</span>
                            <span class="px-2 py-1 rounded-full ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                ${course.course_type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                            </span>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</span>
                                <span class="font-medium">${students}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span>
                                <span class="font-medium">${course.level || 1}</span>
                            </div>
                        </div>
                        <button onclick="uploadCourseMaterial('${course.__backendId}')" class="w-full mt-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            Ø±ÙØ¹ Ù…ÙˆØ§Ø¯ Ø¯Ø±Ø§Ø³ÙŠØ©
                        </button>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function renderDoctorStudents(container) {
    // Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„ØªÙŠ ÙŠØ¯Ø±Ø³Ù‡Ø§
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const students = allData.filter(d => d.type === 'user' && d.role === 'student');
    
    // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ¯Ø±Ø³ÙˆÙ† Ù…Ù‚Ø±Ø±Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙƒØªÙˆØ±
    const doctorStudents = students.filter(student => {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ ØªØ®ØµØµ ÙŠØ¯Ø±Ø³ ÙÙŠÙ‡ Ø§Ù„Ø¯ÙƒØªÙˆØ± Ù…Ù‚Ø±Ø±Ø§Ù‹
        return doctorCourses.some(course => course.specialization_id === student.specialization_id);
    });
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
            <p class="text-gray-400">Ø·Ù„Ø§Ø¨ÙŠ ÙÙŠ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ®ØµØµ</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
                            <th class="text-right py-3 px-4">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${doctorStudents.map(student => {
                            const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === student.specialization_id);
                            const group = allData.find(g => g.type === 'group' && g.__backendId === student.group_id);
                            
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${student.name}</td>
                                    <td class="py-3 px-4">${student.email}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">${group ? group.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">
                                        <div class="flex items-center gap-2">
                                            <div class="w-16 h-2 bg-white/10 rounded-full overflow-hidden">
                                                <div class="h-full bg-teal-500" style="width: ${Math.floor(Math.random() * 30) + 70}%"></div>
                                            </div>
                                            <span>${Math.floor(Math.random() * 30) + 70}%</span>
                                        </div>
                                    </td>
                                    <td class="py-3 px-4">
                                        <button onclick="viewStudentDetails('${student.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                            Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function renderDoctorAttendance(container) {
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h1>
            <p class="text-gray-400">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø·Ù„Ø§Ø¨Ùƒ</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
                <div class="space-y-3">
                    ${Array.from({length: 3}).map((_, i) => {
                        const courses = ['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨'];
                        const times = ['08:00 - 10:00', '10:00 - 12:00', '14:00 - 16:00'];
                        const rooms = ['Ù‚Ø§Ø¹Ø© 101', 'Ù…Ø¹Ù…Ù„ 203', 'Ù‚Ø§Ø¹Ø© 305'];
                        
                        return `
                            <div class="p-4 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-medium">${courses[i]}</h3>
                                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                        ${times[i]}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-400 mb-3">${rooms[i]}</p>
                                <button onclick="startAttendanceSession(${i})" class="w-full py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                    Ø¨Ø¯Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                                </button>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
                <div class="space-y-6">
                    <div>
                        <h3 class="font-medium mb-2">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ù‚Ø±Ø±</h3>
                        <div class="space-y-3">
                            ${['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨', 'Ø§Ù„Ø´Ø¨ÙƒØ§Øª', 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª'].map((course, i) => {
                                const percentage = [94, 91, 89, 87, 85][i];
                                return `
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm">${course}</span>
                                            <span class="text-sm">${percentage}%</span>
                                        </div>
                                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-teal-500" style="width: ${percentage}%"></div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-medium mb-2">Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                        <div class="space-y-2">
                            ${['Ø§Ù„ÙŠÙˆÙ… 08:00', 'Ø£Ù…Ø³ 14:00', 'Ù¢Ù /Ù¡Ù  10:00'].map((time, i) => {
                                const courses = ['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨'];
                                return `
                                    <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                                        <span>${courses[i]}</span>
                                        <span class="text-sm text-gray-400">${time}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function uploadCourseMaterial(courseId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø±ÙØ¹ Ù…ÙˆØ§Ø¯ Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
            <p class="text-gray-400">Ø£Ø±ÙØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨</p>
        </div>
        <form onsubmit="handleMaterialUpload(event, '${courseId}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="material-title" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…Ø«Ù„: Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ÙˆØµÙ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <textarea id="material-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ø§Ø¯Ø©..."></textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="material-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                        <option value="lecture">Ù…Ø­Ø§Ø¶Ø±Ø©</option>
                        <option value="assignment">ÙˆØ§Ø¬Ø¨</option>
                        <option value="exam">Ø§Ù…ØªØ­Ø§Ù†</option>
                        <option value="resource">Ù…Ø±Ø¬Ø¹</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø±ÙØ¹ Ù…Ù„Ù</label>
                    <div class="border-2 border-dashed border-white/20 rounded-xl p-6 text-center">
                        <svg class="w-12 h-12 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <p class="text-gray-400 mb-2">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ</p>
                        <input type="file" id="material-file" class="hidden" accept=".pdf,.doc,.docx,.ppt,.pptx">
                        <label for="material-file" class="cursor-pointer px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            Ø§Ø®ØªØ± Ù…Ù„Ù
                        </label>
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø±ÙØ¹</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

function handleMaterialUpload(e, courseId) {
    e.preventDefault();
    showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    hideModal();
}

function startAttendanceSession(index) {
    showToast(`Ø¨Ø¯Ø£Øª Ø¬Ù„Ø³Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ${index + 1}`, 'info');
}

function viewStudentDetails(studentId) {
    const student = allData.find(d => d.type === 'user' && d.__backendId === studentId);
    if (!student) return;
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
            <p class="text-gray-400">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ£Ø¯Ø§Ø¤Ù‡</p>
        </div>
        
        <div class="space-y-6">
            <div class="flex items-center gap-4 p-4 rounded-xl bg-white/5">
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                    <span class="text-xl font-bold">${student.name.charAt(0)}</span>
                </div>
                <div>
                    <h3 class="font-bold text-lg">${student.name}</h3>
                    <p class="text-gray-400">${student.email}</p>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="p-4 rounded-xl bg-white/5">
                    <p class="text-gray-400 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</p>
                    <p class="text-2xl font-bold text-teal-400">${Math.floor(Math.random() * 30) + 70}%</p>
                </div>
                <div class="p-4 rounded-xl bg-white/5">
                    <p class="text-gray-400 text-sm">Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª</p>
                    <p class="text-2xl font-bold text-orange-400">${Math.floor(Math.random() * 5)}</p>
                </div>
            </div>
            
            <div>
                <h3 class="font-medium mb-3">Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                <div class="space-y-2">
                    ${['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨'].map(course => `
                        <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                            <span>${course}</span>
                            <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                ${Math.floor(Math.random() * 30) + 70}%
                            </span>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    `;
    showModal(content);
}

// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© renderStudentContent
function renderStudentContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderStudentDashboard(container);
            break;
        case 'full-schedule':
            renderStudentFullSchedule(container);
            break;
        case 'today-schedule':
            renderStudentTodaySchedule(container);
            break;
        case 'my-courses':
            renderStudentCourses(container);
            break;
        case 'my-doctors':
            renderStudentDoctors(container);
            break;
        case 'my-attendance':
            renderStudentAttendance(container);
            break;
        default:
            renderStudentDashboard(container);
    }
}

function renderStudentFullSchedule(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„</h1>
            <p class="text-gray-400">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="grid grid-cols-7 gap-4 mb-4">
                ${['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'].map(day => `
                    <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                `).join('')}
            </div>
            <div class="grid grid-cols-7 gap-4">
                ${Array.from({length: 7}, (_, dayIndex) => {
                    const daySchedules = studentSchedules.filter(s => s.day === dayIndex);
                    return `
                        <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                            ${daySchedules.map(schedule => {
                                const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                                const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                                const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                                return `
                                    <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                        <div class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-sm text-gray-400">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-xs text-gray-500">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function renderStudentTodaySchedule(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    const today = new Date().getDay();
    const todaySchedules = studentSchedules.filter(schedule => schedule.day === today);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…</h1>
            <p class="text-gray-400">Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="space-y-4">
                ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                    const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                    const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                    const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                    
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø§Ù„Ø© Ø­Ø¶ÙˆØ± Ø§Ù„Ø¯ÙƒØªÙˆØ±
                    const isDoctorPresent = Math.random() > 0.2; // 80% Ø­Ø¶ÙˆØ±
                    
                    return `
                        <div class="p-4 rounded-xl ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="font-bold text-lg">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</h3>
                                    <p class="text-gray-400">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-xl">${schedule.start_time} - ${schedule.end_time}</div>
                                    <div class="text-sm text-gray-400">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between mt-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full ${isDoctorPresent ? 'bg-green-500 pulse-dot' : 'bg-red-500'}"></div>
                                    <span class="text-sm ${isDoctorPresent ? 'text-green-400' : 'text-red-400'}">
                                        ${isDoctorPresent ? 'Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø­Ø§Ø¶Ø±' : 'Ø§Ù„Ø¯ÙƒØªÙˆØ± ØºØ§Ø¦Ø¨'}
                                    </span>
                                </div>
                                
                                <div class="flex gap-2">
                                    <button onclick="confirmAttendance('${schedule.__backendId}')" class="px-4 py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                        ØªØ£ÙƒÙŠØ¯ Ø­Ø¶ÙˆØ±ÙŠ
                                    </button>
                                    <button onclick="viewCourseMaterials('${course ? course.__backendId : ''}')" class="px-4 py-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                        Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('') : `
                    <div class="text-center py-12">
                        <svg class="w-20 h-20 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <h3 class="text-xl font-medium mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                        <p class="text-gray-400">Ø§Ø³ØªÙ…ØªØ¹ Ø¨ÙŠÙˆÙ… Ø¥Ø¬Ø§Ø²Ø©!</p>
                    </div>
                `}
            </div>
        </div>
    `;
}

function renderStudentCourses(container) {
    // Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ®ØµØµÙ‡
    const studentCourses = allData.filter(d => d.type === 'course' && d.specialization_id === currentUser.specialization_id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù…Ù‚Ø±Ø±Ø§ØªÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h1>
            <p class="text-gray-400">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ ØªØ®ØµØµÙŠ</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${studentCourses.map(course => {
                const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'} flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <span class="text-2xl font-bold">${course.hours || 0}</span>
                        </div>
                        <h3 class="font-semibold text-lg mb-2">${course.name}</h3>
                        <p class="text-gray-400 text-sm mb-4">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                        <div class="flex items-center justify-between text-sm mb-4">
                            <span class="text-gray-400">${course.code || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø²'}</span>
                            <span class="px-2 py-1 rounded-full ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                ${course.course_type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                            </span>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span>
                                <span class="font-medium">${course.level || 1}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</span>
                                <span class="font-medium">${course.hours || 0} Ø³Ø§Ø¹Ø©</span>
                            </div>
                        </div>
                        <button onclick="viewCourseMaterials('${course.__backendId}')" class="w-full mt-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
                        </button>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function viewCourseMaterials(courseId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
            <p class="text-gray-400">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
        </div>
        
        <div class="space-y-4">
            ${Array.from({length: 3}).map((_, i) => {
                const materials = ['Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„', 'ÙˆØ§Ø¬Ø¨ Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„', 'Ù…Ø±Ø¬Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'];
                const types = ['PDF', 'DOC', 'PDF'];
                const dates = ['Ø§Ù„ÙŠÙˆÙ…', 'Ø£Ù…Ø³', 'Ù…Ù†Ø° 3 Ø£ÙŠØ§Ù…'];
                
                return `
                    <div class="p-4 rounded-xl bg-white/5 border border-white/10">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-medium">${materials[i]}</h3>
                            <span class="px-2 py-1 rounded-full text-xs bg-blue-500/20 text-blue-400">
                                ${types[i]}
                            </span>
                        </div>
                        <p class="text-sm text-gray-400 mb-3">Ù…Ø§Ø¯Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">${dates[i]}</span>
                            <button class="px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                ØªØ­Ù…ÙŠÙ„
                            </button>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    `;
    showModal(content);
}

function renderStudentDoctors(container) {
    // Ø¯ÙƒØ§ØªØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª ÙÙŠ ØªØ®ØµØµÙ‡
    const studentCourses = allData.filter(d => d.type === 'course' && d.specialization_id === currentUser.specialization_id);
    const doctorIds = [...new Set(studentCourses.map(course => course.doctor_id))];
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor' && doctorIds.includes(d.__backendId));
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø¯ÙƒØ§ØªØ±ØªÙŠ</h1>
            <p class="text-gray-400">Ø£Ø¹Ø¶Ø§Ø¡ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³ ÙÙŠ ØªØ®ØµØµÙŠ</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${doctors.map(doctor => {
                const doctorCourses = studentCourses.filter(course => course.doctor_id === doctor.__backendId);
                
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-16 h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                                <span class="text-xl font-bold">${doctor.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg">${doctor.name}</h3>
                                <p class="text-gray-400 text-sm">${doctor.email}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="p-3 rounded-lg bg-white/5">
                                <p class="text-gray-400 text-sm mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</p>
                                <p class="font-medium">${doctorCourses.length} Ù…Ù‚Ø±Ø±</p>
                            </div>
                            
                            <div class="p-3 rounded-lg bg-white/5">
                                <p class="text-gray-400 text-sm mb-1">Ø§Ù„ØªÙˆØ§ØµÙ„</p>
                                <div class="flex gap-2">
                                    <button onclick="contactDoctor('${doctor.__backendId}')" class="flex-1 py-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 text-sm">
                                        Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
                                    </button>
                                    <button onclick="viewDoctorSchedule('${doctor.__backendId}')" class="flex-1 py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                        Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªØ¨
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <p class="text-gray-400 text-sm mb-2">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª:</p>
                            <div class="flex flex-wrap gap-1">
                                ${doctorCourses.slice(0, 3).map(course => `
                                    <span class="px-2 py-1 rounded-full text-xs bg-white/10">
                                        ${course.name}
                                    </span>
                                `).join('')}
                                ${doctorCourses.length > 3 ? `
                                    <span class="px-2 py-1 rounded-full text-xs bg-white/10">
                                        +${doctorCourses.length - 3} Ø£ÙƒØ«Ø±
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function renderStudentAttendance(container) {
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h1>
            <p class="text-gray-400">Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø¶ÙˆØ±Ùƒ ÙÙŠ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
                <div class="space-y-6">
                    <div class="text-center">
                        <div class="inline-flex items-center justify-center w-40 h-40 rounded-full border-8 border-teal-500/20 relative">
                            <div class="absolute inset-0 rounded-full border-8 border-teal-500" style="clip-path: polygon(0 0, 100% 0, 100% 85%, 0 85%);"></div>
                            <div class="text-center">
                                <div class="text-4xl font-bold">92%</div>
                                <div class="text-gray-400 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-teal-400">45</div>
                            <div class="text-gray-400 text-sm">Ù…Ø­Ø§Ø¶Ø±Ø© Ø­Ø¶Ø±Øª</div>
                        </div>
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-orange-400">4</div>
                            <div class="text-gray-400 text-sm">Ù…Ø­Ø§Ø¶Ø±Ø© ØºØ¨Øª</div>
                        </div>
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-blue-400">2</div>
                            <div class="text-gray-400 text-sm">Ø¥Ø¬Ø§Ø²Ø©</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ù‚Ø±Ø±</h2>
                <div class="space-y-4">
                    ${['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨', 'Ø§Ù„Ø´Ø¨ÙƒØ§Øª', 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª'].map((course, i) => {
                        const percentages = [94, 91, 89, 87, 85];
                        const attended = [28, 26, 25, 24, 23];
                        const missed = [2, 3, 3, 4, 4];
                        
                        return `
                            <div class="p-4 rounded-xl bg-white/5">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-medium">${course}</h3>
                                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                        ${percentages[i]}%
                                    </span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">Ø­Ø¶Ø±Øª: ${attended[i]}</span>
                                    <span class="text-gray-400">ØºØ¨Øª: ${missed[i]}</span>
                                    <span class="text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${attended[i] + missed[i]}</span>
                                </div>
                                <div class="mt-2 h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-teal-500" style="width: ${percentages[i]}%"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>
        
        <div class="glass-card rounded-2xl p-6 mt-6">
            <h2 class="text-xl font-bold mb-4">Ø¢Ø®Ø± 10 Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ÙˆÙ‚Øª</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Array.from({length: 10}).map((_, i) => {
                            const courses = ['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨'];
                            const dates = ['Ø§Ù„ÙŠÙˆÙ…', 'Ø£Ù…Ø³', 'Ù¢Ù /Ù¡Ù ', 'Ù¡Ù©/Ù¡Ù ', 'Ù¡Ù¨/Ù¡Ù '];
                            const times = ['08:00', '10:00', '14:00'];
                            const statuses = ['Ø­Ø§Ø¶Ø±', 'Ø­Ø§Ø¶Ø±', 'ØºØ§Ø¦Ø¨', 'Ø­Ø§Ø¶Ø±', 'Ø­Ø§Ø¶Ø±', 'Ø¥Ø¬Ø§Ø²Ø©'];
                            
                            const course = courses[i % 3];
                            const date = dates[i % 5];
                            const time = times[i % 3];
                            const status = statuses[i % 6];
                            
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${course}</td>
                                    <td class="py-3 px-4">${date}</td>
                                    <td class="py-3 px-4">${time}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${
                                            status === 'Ø­Ø§Ø¶Ø±' ? 'bg-green-500/20 text-green-400' : 
                                            status === 'ØºØ§Ø¦Ø¨' ? 'bg-red-500/20 text-red-400' : 
                                            'bg-orange-500/20 text-orange-400'
                                        }">
                                            ${status}
                                        </span>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function contactDoctor(doctorId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¯ÙƒØªÙˆØ±</h2>
            <p class="text-gray-400">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£Ø³ØªØ§Ø°Ùƒ</p>
        </div>
        <form onsubmit="sendMessage(event, '${doctorId}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label>
                    <input type="text" id="message-subject" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                    <textarea id="message-content" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="5" required placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø±Ø³Ø§Ù„</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

function sendMessage(e, doctorId) {
    e.preventDefault();
    showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    hideModal();
}

function viewDoctorSchedule(doctorId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªØ¨</h2>
            <p class="text-gray-400">Ø£ÙˆÙ‚Ø§Øª Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¯ÙƒØªÙˆØ±</p>
        </div>
        
        <div class="space-y-4">
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">Ø§Ù„Ø£Ø­Ø¯</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        10:00 - 12:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">Ù‚Ø§Ø¹Ø© 301 - Ù…Ø¨Ù†Ù‰ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
            </div>
            
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        14:00 - 16:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">Ù‚Ø§Ø¹Ø© 301 - Ù…Ø¨Ù†Ù‰ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
            </div>
            
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">Ø§Ù„Ø®Ù…ÙŠØ³</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        09:00 - 11:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">Ù‚Ø§Ø¹Ø© 301 - Ù…Ø¨Ù†Ù‰ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
            </div>
        </div>
        
        <div class="mt-6 p-4 rounded-xl bg-blue-500/10 border border-blue-500/20">
            <h3 class="font-medium mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h3>
            <ul class="text-sm text-gray-400 space-y-1">
                <li>â€¢ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯</li>
                <li>â€¢ ÙŠÙ…ÙƒÙ† Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ù…Ø³Ø¨Ù‚ Ø¹Ø¨Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</li>
                <li>â€¢ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©: 555-0123</li>
            </ul>
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    `;
    showModal(content);
}

// Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø± 450ØŒ Ø£Ø¶Ù Ø¯Ø§Ù„Ø© loadInitialData Ù…Ø­Ø¯Ø«Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©


// Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø± 950ØŒ Ø£Ø¶Ù Ø¯Ø§Ù„Ø© editSpecialization
async function editSpecialization(id) {
    const specialization = allData.find(d => d.type === 'specialization' && d.__backendId === id);
    if (!specialization) return;
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ®ØµØµ</h2>
            <p class="text-gray-400">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®ØµØµ</p>
        </div>
        <form onsubmit="updateSpecialization(event, '${id}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</label>
                    <input type="text" id="edit-spec-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="${specialization.name}" required>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function updateSpecialization(e, id) {
    e.preventDefault();
    const name = document.getElementById('edit-spec-name').value;
    
    try {
        await db.collection('specializations').doc(id).update({
            name: name,
            updated_at: new Date().toISOString()
        });
        
        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        const index = allData.findIndex(d => d.type === 'specialization' && d.__backendId === id);
        if (index !== -1) {
            allData[index].name = name;
        }
        
        updateUI();
    } catch (error) {
        console.error("Error updating specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµ', 'error');
    }
}// Ø¨Ø¹Ø¯ Ø³Ø·Ø± 1070ØŒ Ø£Ø¶Ù Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ:

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø© (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminDoctors(container) {
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</h1>
                <button onclick="showAddDoctorModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ±
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¹Ø¶Ø§Ø¡ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ù„Ø§Ø³Ù…</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${doctors.map(doctor => {
                            const courses = allData.filter(d => d.type === 'course' && d.doctor_id === doctor.__backendId).length;
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${doctor.name}</td>
                                    <td class="py-3 px-4">${doctor.email}</td>
                                    <td class="py-3 px-4">${doctor.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td class="py-3 px-4">${courses}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400">Ù†Ø´Ø·</span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editDoctor('${doctor.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteDoctor('${doctor.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddDoctorModal() {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ± Ø¬Ø¯ÙŠØ¯</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
        </div>
        <form onsubmit="addDoctor(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="doctor-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="doctor-email" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="doctor-phone" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</label>
                    <input type="text" id="doctor-password" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="doctor123" readonly>
                    <p class="text-xs text-gray-400 mt-1">Ø³ÙŠØªÙ… ØªØºÙŠÙŠØ±Ù‡Ø§ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„</p>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addDoctor(e) {
    e.preventDefault();
    const name = document.getElementById('doctor-name').value;
    const email = document.getElementById('doctor-email').value;
    const phone = document.getElementById('doctor-phone').value;
    const password = document.getElementById('doctor-password').value;

    try {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙÙŠ Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙƒØªÙˆØ± ÙÙŠ Firestore
        await db.collection('users').doc(user.uid).set({
            name: name,
            email: email,
            phone: phone || '',
            role: 'doctor',
            status: 'active',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'user',
            __backendId: user.uid,
            name: name,
            email: email,
            phone: phone || '',
            role: 'doctor',
            status: 'active'
        });

        updateUI();
    } catch (error) {
        console.error("Error adding doctor:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙƒØªÙˆØ±', 'error');
    }
}

async function deleteDoctor(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙƒØªÙˆØ±ØŸ')) return;
    
    try {
        // Ø­Ø°Ù Ù…Ù† Firestore
        await db.collection('users').doc(id).delete();
        
        // Ø­Ø°Ù Ù…Ù† Authentication (ÙŠØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¥Ø¯Ø§Ø±ÙŠØ© ÙÙŠ Firebase)
        // Note: Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø®Ø§ØµØ© ÙÙŠ Firebase
        
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData = allData.filter(d => !(d.type === 'user' && d.__backendId === id && d.role === 'doctor'));
        updateUI();
    } catch (error) {
        console.error("Error deleting doctor:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminCourses(container) {
    const courses = allData.filter(d => d.type === 'course');
    const specializations = allData.filter(d => d.type === 'specialization');
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h1>
                <button onclick="showAddCourseModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø±
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø±Ù…Ø² Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ®ØµØµ</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¯ÙƒØªÙˆØ±</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù†ÙˆØ¹</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${courses.map(course => {
                            const specialization = specializations.find(s => s.__backendId === course.specialization_id);
                            const doctor = doctors.find(d => d.__backendId === course.doctor_id);
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4 font-mono">${course.code || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td class="py-3 px-4">${course.name}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">${course.hours || 0}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                            ${course.course_type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">${course.level || 1}</td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editCourse('${course.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteCourse('${course.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddCourseModal() {
    const specializations = allData.filter(d => d.type === 'specialization');
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
        </div>
        <form onsubmit="addCourse(event)">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø±Ù…Ø² Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                        <input type="text" id="course-code" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                        <input type="text" id="course-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ØªØ®ØµØµ</label>
                        <select id="course-specialization" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
                            ${specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø¯ÙƒØªÙˆØ±</label>
                        <select id="course-doctor" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙƒØªÙˆØ±</option>
                            ${doctors.map(d => `<option value="${d.__backendId}">${d.name}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label>
                        <input type="number" id="course-hours" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" min="1" max="10" value="3" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                        <select id="course-level" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            ${[1,2,3,4,5,6,7,8].map(l => `<option value="${l}">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${l}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                        <select id="course-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="theoretical">Ù†Ø¸Ø±ÙŠ</option>
                            <option value="practical">Ø¹Ù…Ù„ÙŠ</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="course-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3"></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addCourse(e) {
    e.preventDefault();
    const code = document.getElementById('course-code').value;
    const name = document.getElementById('course-name').value;
    const specialization_id = document.getElementById('course-specialization').value;
    const doctor_id = document.getElementById('course-doctor').value;
    const hours = document.getElementById('course-hours').value;
    const level = document.getElementById('course-level').value;
    const course_type = document.getElementById('course-type').value;
    const description = document.getElementById('course-description').value;

    try {
        const docRef = await db.collection('courses').add({
            code: code,
            name: name,
            specialization_id: specialization_id,
            doctor_id: doctor_id,
            hours: parseInt(hours),
            level: parseInt(level),
            course_type: course_type,
            description: description || '',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø±Ø± Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'course',
            __backendId: docRef.id,
            code: code,
            name: name,
            specialization_id: specialization_id,
            doctor_id: doctor_id,
            hours: parseInt(hours),
            level: parseInt(level),
            course_type: course_type,
            description: description || ''
        });

        updateUI();
    } catch (error) {
        console.error("Error adding course:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø±Ø±', 'error');
    }
}

async function deleteCourse(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø±Ø±ØŸ')) return;
    
    try {
        await db.collection('courses').doc(id).delete();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø±Ø±');
        
        allData = allData.filter(d => !(d.type === 'course' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting course:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminSchedules(container) {
    const schedules = allData.filter(d => d.type === 'schedule');
    const courses = allData.filter(d => d.type === 'course');
    const groups = allData.filter(d => d.type === 'group');
    const rooms = allData.filter(d => d.type === 'room');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</h1>
                <button onclick="showAddScheduleModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø©
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø±ÙŠØ© ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="grid grid-cols-7 gap-4 mb-4">
                ${['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'].map(day => `
                    <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                `).join('')}
            </div>
            <div class="grid grid-cols-7 gap-4">
                ${Array.from({length: 7}, (_, dayIndex) => {
                    const daySchedules = schedules.filter(s => s.day === dayIndex);
                    return `
                        <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                            ${daySchedules.map(schedule => {
                                const course = courses.find(c => c.__backendId === schedule.course_id);
                                const group = groups.find(g => g.__backendId === schedule.group_id);
                                const room = rooms.find(r => r.__backendId === schedule.room_id);
                                return `
                                    <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                        <div class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-sm text-gray-400">${group ? group.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-xs text-gray-500">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="flex gap-1 mt-2">
                                            <button onclick="editSchedule('${schedule.__backendId}')" class="text-xs px-2 py-1 rounded bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteSchedule('${schedule.__backendId}')" class="text-xs px-2 py-1 rounded bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function showAddScheduleModal() {
    const courses = allData.filter(d => d.type === 'course');
    const groups = allData.filter(d => d.type === 'group');
    const rooms = allData.filter(d => d.type === 'room');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <p class="text-gray-400">Ø¬Ø¯ÙˆÙ„Ø© Ù…Ø­Ø§Ø¶Ø±Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
        </div>
        <form onsubmit="addSchedule(event)">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                        <select id="schedule-course" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø±Ø±</option>
                            ${courses.map(c => `<option value="${c.__backendId}">${c.code} - ${c.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label>
                        <select id="schedule-group" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            ${groups.map(g => `<option value="${g.__backendId}">${g.name}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ÙŠÙˆÙ…</label>
                        <select id="schedule-day" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="0">Ø§Ù„Ø£Ø­Ø¯</option>
                            <option value="1">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
                            <option value="2">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                            <option value="3">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                            <option value="4">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                            <option value="5">Ø§Ù„Ø¬Ù…Ø¹Ø©</option>
                            <option value="6">Ø§Ù„Ø³Ø¨Øª</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                        <select id="schedule-room" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¹Ø©</option>
                            ${rooms.map(r => `<option value="${r.__backendId}">${r.name} (${r.type === 'lecture' ? 'Ù‚Ø§Ø¹Ø©' : 'Ù…Ø¹Ù…Ù„'})</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                        <input type="time" id="schedule-start" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required value="08:00">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                        <input type="time" id="schedule-end" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required value="10:00">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</label>
                    <select id="schedule-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                        <option value="theoretical">Ù†Ø¸Ø±ÙŠ</option>
                        <option value="practical">Ø¹Ù…Ù„ÙŠ</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addSchedule(e) {
    e.preventDefault();
    const course_id = document.getElementById('schedule-course').value;
    const group_id = document.getElementById('schedule-group').value;
    const day = parseInt(document.getElementById('schedule-day').value);
    const room_id = document.getElementById('schedule-room').value;
    const start_time = document.getElementById('schedule-start').value;
    const end_time = document.getElementById('schedule-end').value;
    const type = document.getElementById('schedule-type').value;

    try {
        const docRef = await db.collection('schedules').add({
            course_id: course_id,
            group_id: group_id,
            day: day,
            room_id: room_id,
            start_time: start_time,
            end_time: end_time,
            type: type,
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'schedule',
            __backendId: docRef.id,
            course_id: course_id,
            group_id: group_id,
            day: day,
            room_id: room_id,
            start_time: start_time,
            end_time: end_time,
            type: type
        });

        updateUI();
    } catch (error) {
        console.error("Error adding schedule:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©', 'error');
    }
}

async function deleteSchedule(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŸ')) return;
    
    try {
        await db.collection('schedules').doc(id).delete();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©');
        
        allData = allData.filter(d => !(d.type === 'schedule' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting schedule:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminGroups(container) {
    const groups = allData.filter(d => d.type === 'group');
    const specializations = allData.filter(d => d.type === 'specialization');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h1>
                <button onclick="showAddGroupModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø©
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ®ØµØµ</th>
                            <th class="text-right py-3 px-4">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø³Ø¹Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${groups.map(group => {
                            const specialization = specializations.find(s => s.__backendId === group.specialization_id);
                            const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.group_id === group.__backendId).length;
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${group.name}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">${students}</td>
                                    <td class="py-3 px-4">${group.capacity || 30}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${students < (group.capacity || 30) ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                                            ${students < (group.capacity || 30) ? 'Ù…ØªØ§Ø­Ø©' : 'Ù…Ù…ØªÙ„Ø¦Ø©'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editGroup('${group.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button onclick="deleteGroup('${group.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                Ø­Ø°Ù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddGroupModal() {
    const specializations = allData.filter(d => d.type === 'specialization');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
        </div>
        <form onsubmit="addGroup(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label>
                    <input type="text" id="group-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…Ø«Ù„: Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ØªØ®ØµØµ</label>
                        <select id="group-specialization" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
                            ${specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø³Ø¹Ø©</label>
                        <input type="number" id="group-capacity" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" min="1" max="100" value="30" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="group-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="2" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©..."></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addGroup(e) {
    e.preventDefault();
    const name = document.getElementById('group-name').value;
    const specialization_id = document.getElementById('group-specialization').value;
    const capacity = document.getElementById('group-capacity').value;
    const description = document.getElementById('group-description').value;

    try {
        const docRef = await db.collection('groups').add({
            name: name,
            specialization_id: specialization_id,
            capacity: parseInt(capacity),
            description: description || '',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        allData.push({
            type: 'group',
            __backendId: docRef.id,
            name: name,
            specialization_id: specialization_id,
            capacity: parseInt(capacity),
            description: description || ''
        });

        updateUI();
    } catch (error) {
        console.error("Error adding group:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', 'error');
    }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª (Ù„Ù„Ø¹Ù…Ø§Ø¯Ø©)
function renderAdminRooms(container) {
    const rooms = allData.filter(d => d.type === 'room');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</h1>
                <button onclick="showAddRoomModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø©
                </button>
            </div>
            <p class="text-gray-400 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ø§Ù…Ù„</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù†ÙˆØ¹</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø³Ø¹Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rooms.map(room => `
                            <tr class="border-b border-white/5 hover:bg-white/5">
                                <td class="py-3 px-4">${room.name}</td>
                                <td class="py-3 px-4">
                                    <span class="px-2 py-1 rounded-full text-xs ${room.type === 'lecture' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                        ${room.type === 'lecture' ? 'Ù‚Ø§Ø¹Ø© Ù…Ø­Ø§Ø¶Ø±Ø§Øª' : 'Ù…Ø¹Ù…Ù„'}
                                    </span>
                                </td>
                                <td class="py-3 px-4">${room.capacity}</td>
                                <td class="py-3 px-4">${room.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                <td class="py-3 px-4">${room.equipment || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                                <td class="py-3 px-4">
                                    <span class="px-2 py-1 rounded-full text-xs ${room.status === 'available' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                                        ${room.status === 'available' ? 'Ù…ØªØ§Ø­Ø©' : 'ØºÙŠØ± Ù…ØªØ§Ø­Ø©'}
                                    </span>
                                </td>
                                <td class="py-3 px-4">
                                    <div class="flex gap-2">
                                        <button onclick="editRoom('${room.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                            ØªØ¹Ø¯ÙŠÙ„
                                        </button>
                                        <button onclick="deleteRoom('${room.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                            Ø­Ø°Ù
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

// ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ±
function renderDoctorDashboard(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const doctorSchedules = allData.filter(d => d.type === 'schedule');
    const today = new Date().getDay(); // 0-6 where 0 is Sunday
    
    const todaySchedules = doctorSchedules.filter(schedule => {
        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
        return course && course.doctor_id === currentUser.id && schedule.day === today;
    });

    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¯ÙƒØªÙˆØ± ${currentUser.name}</h1>
            <p class="text-gray-400">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¯ÙƒØªÙˆØ±</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${doctorCourses.length}</span>
                </div>
                <h3 class="font-semibold text-lg">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h3>
                <p class="text-gray-400 text-sm">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ù†Ø¯Ø© Ø¥Ù„ÙŠÙƒ</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${todaySchedules.length}</span>
                </div>
                <h3 class="font-semibold text-lg">Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                <p class="text-gray-400 text-sm">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ÙŠÙˆÙ…</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">85%</span>
                </div>
                <h3 class="font-semibold text-lg">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                <p class="text-gray-400 text-sm">Ù…ØªÙˆØ³Ø· Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h2>
                <div class="space-y-3">
                    ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                        const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                        const group = allData.find(g => g.type === 'group' && g.__backendId === schedule.group_id);
                        
                        return `
                            <div class="p-3 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</h3>
                                        <p class="text-sm text-gray-400">${group ? group.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} - ${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-medium">${schedule.start_time} - ${schedule.end_time}</div>
                                        <button onclick="takeAttendance('${schedule.__backendId}')" class="mt-2 px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                            ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('') : `
                        <div class="text-center py-8 text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                    `}
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h2>
                <div class="space-y-3">
                    ${doctorCourses.slice(0, 3).map(course => {
                        const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === course.specialization_id);
                        const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.specialization_id === course.specialization_id).length;
                        
                        return `
                            <div class="p-3 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course.name}</h3>
                                        <p class="text-sm text-gray-400">${specialization ? specialization.name : ''} - ${course.code}</p>
                                    </div>
                                    <span class="px-2 py-1 rounded-full text-xs bg-blue-500/20 text-blue-400">
                                        ${course.course_type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                                    </span>
                                </div>
                                <div class="flex items-center justify-between mt-3 text-sm">
                                    <span class="text-gray-400">${students} Ø·Ø§Ù„Ø¨</span>
                                    <span class="text-gray-400">${course.hours} Ø³Ø§Ø¹Ø©</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>
    `;
}

// ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
function renderStudentDashboard(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    const today = new Date().getDay();
    const todaySchedules = studentSchedules.filter(schedule => schedule.day === today);
    const studentCourses = allData.filter(d => d.type === 'course');
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}</h1>
            <p class="text-gray-400">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ø§Ù„Ø¨</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${todaySchedules.length}</span>
                </div>
                <h3 class="font-semibold text-lg">Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                <p class="text-gray-400 text-sm">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ÙŠÙˆÙ…</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${studentCourses.length}</span>
                </div>
                <h3 class="font-semibold text-lg">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h3>
                <p class="text-gray-400 text-sm">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">92%</span>
                </div>
                <h3 class="font-semibold text-lg">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                <p class="text-gray-400 text-sm">Ø­Ø¶ÙˆØ±Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…</h2>
                <div class="space-y-3">
                    ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                        const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                        const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                        
                        return `
                            <div class="p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</h3>
                                        <p class="text-sm text-gray-400">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-medium">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-sm text-gray-400">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                    </div>
                                </div>
                                <div class="mt-3 flex items-center justify-between text-sm">
                                    <span class="px-2 py-1 rounded-full ${schedule.type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                        ${schedule.type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                                    </span>
                                    <button onclick="confirmAttendance('${schedule.__backendId}')" class="px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('') : `
                        <div class="text-center py-8 text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                    `}
                </div>
            </div>
            
            <div class="glasscard rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ®ØµØµ</h2>
                ${(() => {
                    const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === currentUser.specialization_id);
                    const group = allData.find(g => g.type === 'group' && g.__backendId === currentUser.group_id);
                    
                    if (specialization) {
                        return `
                            <div class="space-y-4">
                                <div class="p-4 rounded-lg bg-white/5">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h3 class="font-medium">${specialization.name}</h3>
                                            <p class="text-sm text-gray-400">ØªØ®ØµØµÙƒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</p>
                                        </div>
                                    </div>
                                </div>
                                
                                ${group ? `
                                    <div class="p-4 rounded-lg bg-white/5">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h3 class="font-medium">${group.name}</h3>
                                                <p class="text-sm text-gray-400">Ù…Ø¬Ù…ÙˆØ¹ØªÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                    return '<p class="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ØªØ§Ø­Ø©</p>';
                })()}
            </div>
        </div>
    `;
}

// ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
function takeAttendance(scheduleId) {
    showToast('ØªÙ… ÙØªØ­ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±', 'info');
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ° Ù…Ù†Ø·Ù‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
}

function confirmAttendance(scheduleId) {
    showToast('ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¶ÙˆØ±Ùƒ', 'success');
}

// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© renderAdminContent
function renderAdminContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderAdminDashboard(container);
            break;
        case 'specializations':
            renderAdminSpecializations(container);
            break;
        case 'doctors':
            renderAdminDoctors(container);
            break;
        case 'courses':
            renderAdminCourses(container);
            break;
        case 'schedules':
            renderAdminSchedules(container);
            break;
        case 'groups':
            renderAdminGroups(container);
            break;
        case 'rooms':
            renderAdminRooms(container);
            break;
        case 'reports':
            renderAdminReports(container);
            break;
        default:
            renderAdminDashboard(container);
    }
}

function renderAdminReports(container) {
    const specializations = allData.filter(d => d.type === 'specialization').length;
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor').length;
    const students = allData.filter(d => d.type === 'user' && d.role === 'student').length;
    const courses = allData.filter(d => d.type === 'course').length;
    const schedules = allData.filter(d => d.type === 'schedule').length;
    const groups = allData.filter(d => d.type === 'group').length;
    const rooms = allData.filter(d => d.type === 'room').length;
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h1>
            <p class="text-gray-400">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø© Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù…</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµØ§Øª</span>
                        <span class="font-bold">${specializations}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</span>
                        <span class="font-bold">${doctors}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                        <span class="font-bold">${students}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</span>
                        <span class="font-bold">${courses}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span>
                        <span class="font-bold">${groups}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</span>
                        <span class="font-bold">${rooms}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</span>
                        <span class="font-bold">${schedules}</span>
                    </div>
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø¹Ø§Ù…Ø©</span>
                            <span>85%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-teal-500" style="width: 85%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù†Ø¸Ø±ÙŠØ©</span>
                            <span>88%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-500" style="width: 88%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span>
                            <span>82%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-orange-500" style="width: 82%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h3 class="font-medium mb-3">Ø£Ø¹Ù„Ù‰ 5 Ù…Ù‚Ø±Ø±Ø§Øª Ø­Ø¶ÙˆØ±Ø§Ù‹</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                            <span class="text-teal-400">94%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                            <span class="text-teal-400">91%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨</span>
                            <span class="text-teal-400">89%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ø§Ù„Ø´Ø¨ÙƒØ§Øª</span>
                            <span class="text-teal-400">87%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</span>
                            <span class="text-teal-400">85%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© renderDoctorContent
function renderDoctorContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderDoctorDashboard(container);
            break;
        case 'my-schedule':
            renderDoctorSchedule(container);
            break;
        case 'my-courses':
            renderDoctorCourses(container);
            break;
        case 'my-students':
            renderDoctorStudents(container);
            break;
        case 'attendance':
            renderDoctorAttendance(container);
            break;
        default:
            renderDoctorDashboard(container);
    }
}

function renderDoctorSchedule(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const schedules = allData.filter(d => d.type === 'schedule');
    const doctorSchedules = schedules.filter(schedule => {
        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
        return course && course.doctor_id === currentUser.id;
    });
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h1>
            <p class="text-gray-400">Ù…Ø­Ø§Ø¶Ø±Ø§ØªÙŠ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="grid grid-cols-7 gap-4 mb-4">
                ${['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'].map(day => `
                    <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                `).join('')}
            </div>
            <div class="grid grid-cols-7 gap-4">
                ${Array.from({length: 7}, (_, dayIndex) => {
                    const daySchedules = doctorSchedules.filter(s => s.day === dayIndex);
                    return `
                        <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                            ${daySchedules.map(schedule => {
                                const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                                const group = allData.find(g => g.type === 'group' && g.__backendId === schedule.group_id);
                                const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                                return `
                                    <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                        <div class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-sm text-gray-400">${group ? group.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-xs text-gray-500">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <button onclick="takeAttendance('${schedule.__backendId}')" class="w-full mt-2 px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                            ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function renderDoctorCourses(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ù…Ø³Ù†Ø¯Ø© Ø¥Ù„ÙŠ</h1>
            <p class="text-gray-400">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªÙŠ Ø£Ù‚ÙˆÙ… Ø¨ØªØ¯Ø±ÙŠØ³Ù‡Ø§</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${doctorCourses.map(course => {
                const specialization = allData.find(d => d.type === 'specialization' && d.__backendId === course.specialization_id);
                const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.specialization_id === course.specialization_id).length;
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'} flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <span class="text-2xl font-bold">${course.hours || 0}</span>
                        </div>
                        <h3 class="font-semibold text-lg mb-2">${course.name}</h3>
                        <p class="text-gray-400 text-sm mb-4">${specialization ? specialization.name : ''}</p>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">${course.code || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø²'}</span>
                            <span class="px-2 py-1 rounded-full ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                ${course.course_type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                            </span>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</span>
                                <span class="font-medium">${students}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span>
                                <span class="font-medium">${course.level || 1}</span>
                            </div>
                        </div>
                        <button onclick="uploadCourseMaterial('${course.__backendId}')" class="w-full mt-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            Ø±ÙØ¹ Ù…ÙˆØ§Ø¯ Ø¯Ø±Ø§Ø³ÙŠØ©
                        </button>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function renderDoctorStudents(container) {
    // Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„ØªÙŠ ÙŠØ¯Ø±Ø³Ù‡Ø§
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const students = allData.filter(d => d.type === 'user' && d.role === 'student');
    
    // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ¯Ø±Ø³ÙˆÙ† Ù…Ù‚Ø±Ø±Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙƒØªÙˆØ±
    const doctorStudents = students.filter(student => {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ ØªØ®ØµØµ ÙŠØ¯Ø±Ø³ ÙÙŠÙ‡ Ø§Ù„Ø¯ÙƒØªÙˆØ± Ù…Ù‚Ø±Ø±Ø§Ù‹
        return doctorCourses.some(course => course.specialization_id === student.specialization_id);
    });
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
            <p class="text-gray-400">Ø·Ù„Ø§Ø¨ÙŠ ÙÙŠ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ®ØµØµ</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
                            <th class="text-right py-3 px-4">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${doctorStudents.map(student => {
                            const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === student.specialization_id);
                            const group = allData.find(g => g.type === 'group' && g.__backendId === student.group_id);
                            
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${student.name}</td>
                                    <td class="py-3 px-4">${student.email}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">${group ? group.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                    <td class="py-3 px-4">
                                        <div class="flex items-center gap-2">
                                            <div class="w-16 h-2 bg-white/10 rounded-full overflow-hidden">
                                                <div class="h-full bg-teal-500" style="width: ${Math.floor(Math.random() * 30) + 70}%"></div>
                                            </div>
                                            <span>${Math.floor(Math.random() * 30) + 70}%</span>
                                        </div>
                                    </td>
                                    <td class="py-3 px-4">
                                        <button onclick="viewStudentDetails('${student.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                            Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function renderDoctorAttendance(container) {
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h1>
            <p class="text-gray-400">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø·Ù„Ø§Ø¨Ùƒ</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
                <div class="space-y-3">
                    ${Array.from({length: 3}).map((_, i) => {
                        const courses = ['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨'];
                        const times = ['08:00 - 10:00', '10:00 - 12:00', '14:00 - 16:00'];
                        const rooms = ['Ù‚Ø§Ø¹Ø© 101', 'Ù…Ø¹Ù…Ù„ 203', 'Ù‚Ø§Ø¹Ø© 305'];
                        
                        return `
                            <div class="p-4 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-medium">${courses[i]}</h3>
                                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                        ${times[i]}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-400 mb-3">${rooms[i]}</p>
                                <button onclick="startAttendanceSession(${i})" class="w-full py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                    Ø¨Ø¯Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                                </button>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
                <div class="space-y-6">
                    <div>
                        <h3 class="font-medium mb-2">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ù‚Ø±Ø±</h3>
                        <div class="space-y-3">
                            ${['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨', 'Ø§Ù„Ø´Ø¨ÙƒØ§Øª', 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª'].map((course, i) => {
                                const percentage = [94, 91, 89, 87, 85][i];
                                return `
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm">${course}</span>
                                            <span class="text-sm">${percentage}%</span>
                                        </div>
                                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-teal-500" style="width: ${percentage}%"></div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-medium mb-2">Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                        <div class="space-y-2">
                            ${['Ø§Ù„ÙŠÙˆÙ… 08:00', 'Ø£Ù…Ø³ 14:00', 'Ù¢Ù /Ù¡Ù  10:00'].map((time, i) => {
                                const courses = ['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨'];
                                return `
                                    <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                                        <span>${courses[i]}</span>
                                        <span class="text-sm text-gray-400">${time}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function uploadCourseMaterial(courseId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø±ÙØ¹ Ù…ÙˆØ§Ø¯ Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
            <p class="text-gray-400">Ø£Ø±ÙØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨</p>
        </div>
        <form onsubmit="handleMaterialUpload(event, '${courseId}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="material-title" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…Ø«Ù„: Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ÙˆØµÙ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <textarea id="material-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ø§Ø¯Ø©..."></textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <select id="material-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                        <option value="lecture">Ù…Ø­Ø§Ø¶Ø±Ø©</option>
                        <option value="assignment">ÙˆØ§Ø¬Ø¨</option>
                        <option value="exam">Ø§Ù…ØªØ­Ø§Ù†</option>
                        <option value="resource">Ù…Ø±Ø¬Ø¹</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø±ÙØ¹ Ù…Ù„Ù</label>
                    <div class="border-2 border-dashed border-white/20 rounded-xl p-6 text-center">
                        <svg class="w-12 h-12 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <p class="text-gray-400 mb-2">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ</p>
                        <input type="file" id="material-file" class="hidden" accept=".pdf,.doc,.docx,.ppt,.pptx">
                        <label for="material-file" class="cursor-pointer px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            Ø§Ø®ØªØ± Ù…Ù„Ù
                        </label>
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø±ÙØ¹</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

function handleMaterialUpload(e, courseId) {
    e.preventDefault();
    showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    hideModal();
}

function startAttendanceSession(index) {
    showToast(`Ø¨Ø¯Ø£Øª Ø¬Ù„Ø³Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ${index + 1}`, 'info');
}

function viewStudentDetails(studentId) {
    const student = allData.find(d => d.type === 'user' && d.__backendId === studentId);
    if (!student) return;
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
            <p class="text-gray-400">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ£Ø¯Ø§Ø¤Ù‡</p>
        </div>
        
        <div class="space-y-6">
            <div class="flex items-center gap-4 p-4 rounded-xl bg-white/5">
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                    <span class="text-xl font-bold">${student.name.charAt(0)}</span>
                </div>
                <div>
                    <h3 class="font-bold text-lg">${student.name}</h3>
                    <p class="text-gray-400">${student.email}</p>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="p-4 rounded-xl bg-white/5">
                    <p class="text-gray-400 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</p>
                    <p class="text-2xl font-bold text-teal-400">${Math.floor(Math.random() * 30) + 70}%</p>
                </div>
                <div class="p-4 rounded-xl bg-white/5">
                    <p class="text-gray-400 text-sm">Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª</p>
                    <p class="text-2xl font-bold text-orange-400">${Math.floor(Math.random() * 5)}</p>
                </div>
            </div>
            
            <div>
                <h3 class="font-medium mb-3">Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                <div class="space-y-2">
                    ${['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨'].map(course => `
                        <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                            <span>${course}</span>
                            <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                ${Math.floor(Math.random() * 30) + 70}%
                            </span>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    `;
    showModal(content);
}

// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© renderStudentContent
function renderStudentContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderStudentDashboard(container);
            break;
        case 'full-schedule':
            renderStudentFullSchedule(container);
            break;
        case 'today-schedule':
            renderStudentTodaySchedule(container);
            break;
        case 'my-courses':
            renderStudentCourses(container);
            break;
        case 'my-doctors':
            renderStudentDoctors(container);
            break;
        case 'my-attendance':
            renderStudentAttendance(container);
            break;
        default:
            renderStudentDashboard(container);
    }
}

function renderStudentFullSchedule(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„</h1>
            <p class="text-gray-400">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="grid grid-cols-7 gap-4 mb-4">
                ${['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'].map(day => `
                    <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                `).join('')}
            </div>
            <div class="grid grid-cols-7 gap-4">
                ${Array.from({length: 7}, (_, dayIndex) => {
                    const daySchedules = studentSchedules.filter(s => s.day === dayIndex);
                    return `
                        <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                            ${daySchedules.map(schedule => {
                                const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                                const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                                const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                                return `
                                    <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                        <div class="font-medium">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-sm text-gray-400">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-xs text-gray-500">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function renderStudentTodaySchedule(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    const today = new Date().getDay();
    const todaySchedules = studentSchedules.filter(schedule => schedule.day === today);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…</h1>
            <p class="text-gray-400">Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="space-y-4">
                ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                    const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                    const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                    const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                    
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø§Ù„Ø© Ø­Ø¶ÙˆØ± Ø§Ù„Ø¯ÙƒØªÙˆØ±
                    const isDoctorPresent = Math.random() > 0.2; // 80% Ø­Ø¶ÙˆØ±
                    
                    return `
                        <div class="p-4 rounded-xl ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="font-bold text-lg">${course ? course.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</h3>
                                    <p class="text-gray-400">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-xl">${schedule.start_time} - ${schedule.end_time}</div>
                                    <div class="text-sm text-gray-400">${room ? room.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between mt-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full ${isDoctorPresent ? 'bg-green-500 pulse-dot' : 'bg-red-500'}"></div>
                                    <span class="text-sm ${isDoctorPresent ? 'text-green-400' : 'text-red-400'}">
                                        ${isDoctorPresent ? 'Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø­Ø§Ø¶Ø±' : 'Ø§Ù„Ø¯ÙƒØªÙˆØ± ØºØ§Ø¦Ø¨'}
                                    </span>
                                </div>
                                
                                <div class="flex gap-2">
                                    <button onclick="confirmAttendance('${schedule.__backendId}')" class="px-4 py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                        ØªØ£ÙƒÙŠØ¯ Ø­Ø¶ÙˆØ±ÙŠ
                                    </button>
                                    <button onclick="viewCourseMaterials('${course ? course.__backendId : ''}')" class="px-4 py-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                        Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('') : `
                    <div class="text-center py-12">
                        <svg class="w-20 h-20 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <h3 class="text-xl font-medium mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                        <p class="text-gray-400">Ø§Ø³ØªÙ…ØªØ¹ Ø¨ÙŠÙˆÙ… Ø¥Ø¬Ø§Ø²Ø©!</p>
                    </div>
                `}
            </div>
        </div>
    `;
}

function renderStudentCourses(container) {
    // Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ®ØµØµÙ‡
    const studentCourses = allData.filter(d => d.type === 'course' && d.specialization_id === currentUser.specialization_id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ù…Ù‚Ø±Ø±Ø§ØªÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h1>
            <p class="text-gray-400">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ ØªØ®ØµØµÙŠ</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${studentCourses.map(course => {
                const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'} flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <span class="text-2xl font-bold">${course.hours || 0}</span>
                        </div>
                        <h3 class="font-semibold text-lg mb-2">${course.name}</h3>
                        <p class="text-gray-400 text-sm mb-4">${doctor ? doctor.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                        <div class="flex items-center justify-between text-sm mb-4">
                            <span class="text-gray-400">${course.code || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø²'}</span>
                            <span class="px-2 py-1 rounded-full ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                ${course.course_type === 'theoretical' ? 'Ù†Ø¸Ø±ÙŠ' : 'Ø¹Ù…Ù„ÙŠ'}
                            </span>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span>
                                <span class="font-medium">${course.level || 1}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</span>
                                <span class="font-medium">${course.hours || 0} Ø³Ø§Ø¹Ø©</span>
                            </div>
                        </div>
                        <button onclick="viewCourseMaterials('${course.__backendId}')" class="w-full mt-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
                        </button>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function viewCourseMaterials(courseId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
            <p class="text-gray-400">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
        </div>
        
        <div class="space-y-4">
            ${Array.from({length: 3}).map((_, i) => {
                const materials = ['Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„', 'ÙˆØ§Ø¬Ø¨ Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„', 'Ù…Ø±Ø¬Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'];
                const types = ['PDF', 'DOC', 'PDF'];
                const dates = ['Ø§Ù„ÙŠÙˆÙ…', 'Ø£Ù…Ø³', 'Ù…Ù†Ø° 3 Ø£ÙŠØ§Ù…'];
                
                return `
                    <div class="p-4 rounded-xl bg-white/5 border border-white/10">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-medium">${materials[i]}</h3>
                            <span class="px-2 py-1 rounded-full text-xs bg-blue-500/20 text-blue-400">
                                ${types[i]}
                            </span>
                        </div>
                        <p class="text-sm text-gray-400 mb-3">Ù…Ø§Ø¯Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">${dates[i]}</span>
                            <button class="px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                ØªØ­Ù…ÙŠÙ„
                            </button>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    `;
    showModal(content);
}

function renderStudentDoctors(container) {
    // Ø¯ÙƒØ§ØªØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª ÙÙŠ ØªØ®ØµØµÙ‡
    const studentCourses = allData.filter(d => d.type === 'course' && d.specialization_id === currentUser.specialization_id);
    const doctorIds = [...new Set(studentCourses.map(course => course.doctor_id))];
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor' && doctorIds.includes(d.__backendId));
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø¯ÙƒØ§ØªØ±ØªÙŠ</h1>
            <p class="text-gray-400">Ø£Ø¹Ø¶Ø§Ø¡ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³ ÙÙŠ ØªØ®ØµØµÙŠ</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${doctors.map(doctor => {
                const doctorCourses = studentCourses.filter(course => course.doctor_id === doctor.__backendId);
                
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-16 h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                                <span class="text-xl font-bold">${doctor.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg">${doctor.name}</h3>
                                <p class="text-gray-400 text-sm">${doctor.email}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="p-3 rounded-lg bg-white/5">
                                <p class="text-gray-400 text-sm mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</p>
                                <p class="font-medium">${doctorCourses.length} Ù…Ù‚Ø±Ø±</p>
                            </div>
                            
                            <div class="p-3 rounded-lg bg-white/5">
                                <p class="text-gray-400 text-sm mb-1">Ø§Ù„ØªÙˆØ§ØµÙ„</p>
                                <div class="flex gap-2">
                                    <button onclick="contactDoctor('${doctor.__backendId}')" class="flex-1 py-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 text-sm">
                                        Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
                                    </button>
                                    <button onclick="viewDoctorSchedule('${doctor.__backendId}')" class="flex-1 py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                        Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªØ¨
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <p class="text-gray-400 text-sm mb-2">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª:</p>
                            <div class="flex flex-wrap gap-1">
                                ${doctorCourses.slice(0, 3).map(course => `
                                    <span class="px-2 py-1 rounded-full text-xs bg-white/10">
                                        ${course.name}
                                    </span>
                                `).join('')}
                                ${doctorCourses.length > 3 ? `
                                    <span class="px-2 py-1 rounded-full text-xs bg-white/10">
                                        +${doctorCourses.length - 3} Ø£ÙƒØ«Ø±
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function renderStudentAttendance(container) {
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h1>
            <p class="text-gray-400">Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø¶ÙˆØ±Ùƒ ÙÙŠ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
                <div class="space-y-6">
                    <div class="text-center">
                        <div class="inline-flex items-center justify-center w-40 h-40 rounded-full border-8 border-teal-500/20 relative">
                            <div class="absolute inset-0 rounded-full border-8 border-teal-500" style="clip-path: polygon(0 0, 100% 0, 100% 85%, 0 85%);"></div>
                            <div class="text-center">
                                <div class="text-4xl font-bold">92%</div>
                                <div class="text-gray-400 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-teal-400">45</div>
                            <div class="text-gray-400 text-sm">Ù…Ø­Ø§Ø¶Ø±Ø© Ø­Ø¶Ø±Øª</div>
                        </div>
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-orange-400">4</div>
                            <div class="text-gray-400 text-sm">Ù…Ø­Ø§Ø¶Ø±Ø© ØºØ¨Øª</div>
                        </div>
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-blue-400">2</div>
                            <div class="text-gray-400 text-sm">Ø¥Ø¬Ø§Ø²Ø©</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ù‚Ø±Ø±</h2>
                <div class="space-y-4">
                    ${['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨', 'Ø§Ù„Ø´Ø¨ÙƒØ§Øª', 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª'].map((course, i) => {
                        const percentages = [94, 91, 89, 87, 85];
                        const attended = [28, 26, 25, 24, 23];
                        const missed = [2, 3, 3, 4, 4];
                        
                        return `
                            <div class="p-4 rounded-xl bg-white/5">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-medium">${course}</h3>
                                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                        ${percentages[i]}%
                                    </span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">Ø­Ø¶Ø±Øª: ${attended[i]}</span>
                                    <span class="text-gray-400">ØºØ¨Øª: ${missed[i]}</span>
                                    <span class="text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${attended[i] + missed[i]}</span>
                                </div>
                                <div class="mt-2 h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-teal-500" style="width: ${percentages[i]}%"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>
        
        <div class="glass-card rounded-2xl p-6 mt-6">
            <h2 class="text-xl font-bold mb-4">Ø¢Ø®Ø± 10 Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th class="text-right py-3 px-4">Ø§Ù„ÙˆÙ‚Øª</th>
                            <th class="text-right py-3 px-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Array.from({length: 10}).map((_, i) => {
                            const courses = ['Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙˆÙŠØ¨'];
                            const dates = ['Ø§Ù„ÙŠÙˆÙ…', 'Ø£Ù…Ø³', 'Ù¢Ù /Ù¡Ù ', 'Ù¡Ù©/Ù¡Ù ', 'Ù¡Ù¨/Ù¡Ù '];
                            const times = ['08:00', '10:00', '14:00'];
                            const statuses = ['Ø­Ø§Ø¶Ø±', 'Ø­Ø§Ø¶Ø±', 'ØºØ§Ø¦Ø¨', 'Ø­Ø§Ø¶Ø±', 'Ø­Ø§Ø¶Ø±', 'Ø¥Ø¬Ø§Ø²Ø©'];
                            
                            const course = courses[i % 3];
                            const date = dates[i % 5];
                            const time = times[i % 3];
                            const status = statuses[i % 6];
                            
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${course}</td>
                                    <td class="py-3 px-4">${date}</td>
                                    <td class="py-3 px-4">${time}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${
                                            status === 'Ø­Ø§Ø¶Ø±' ? 'bg-green-500/20 text-green-400' : 
                                            status === 'ØºØ§Ø¦Ø¨' ? 'bg-red-500/20 text-red-400' : 
                                            'bg-orange-500/20 text-orange-400'
                                        }">
                                            ${status}
                                        </span>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function contactDoctor(doctorId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¯ÙƒØªÙˆØ±</h2>
            <p class="text-gray-400">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£Ø³ØªØ§Ø°Ùƒ</p>
        </div>
        <form onsubmit="sendMessage(event, '${doctorId}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label>
                    <input type="text" id="message-subject" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                    <textarea id="message-content" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="5" required placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø±Ø³Ø§Ù„</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

function sendMessage(e, doctorId) {
    e.preventDefault();
    showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    hideModal();
}

function viewDoctorSchedule(doctorId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªØ¨</h2>
            <p class="text-gray-400">Ø£ÙˆÙ‚Ø§Øª Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¯ÙƒØªÙˆØ±</p>
        </div>
        
        <div class="space-y-4">
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">Ø§Ù„Ø£Ø­Ø¯</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        10:00 - 12:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">Ù‚Ø§Ø¹Ø© 301 - Ù…Ø¨Ù†Ù‰ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
            </div>
            
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        14:00 - 16:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">Ù‚Ø§Ø¹Ø© 301 - Ù…Ø¨Ù†Ù‰ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
            </div>
            
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">Ø§Ù„Ø®Ù…ÙŠØ³</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        09:00 - 11:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">Ù‚Ø§Ø¹Ø© 301 - Ù…Ø¨Ù†Ù‰ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
            </div>
        </div>
        
        <div class="mt-6 p-4 rounded-xl bg-blue-500/10 border border-blue-500/20">
            <h3 class="font-medium mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h3>
            <ul class="text-sm text-gray-400 space-y-1">
                <li>â€¢ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯</li>
                <li>â€¢ ÙŠÙ…ÙƒÙ† Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ù…Ø³Ø¨Ù‚ Ø¹Ø¨Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</li>
                <li>â€¢ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©: 555-0123</li>
            </ul>
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                Ø¥ØºÙ„Ø§Ù‚
            </button>
        </div>
    `;
    showModal(content);
}

// Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø± 450ØŒ Ø£Ø¶Ù Ø¯Ø§Ù„Ø© loadInitialData Ù…Ø­Ø¯Ø«Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©


// Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø± 950ØŒ Ø£Ø¶Ù Ø¯Ø§Ù„Ø© editSpecialization
async function editSpecialization(id) {
    const specialization = allData.find(d => d.type === 'specialization' && d.__backendId === id);
    if (!specialization) return;
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ®ØµØµ</h2>
            <p class="text-gray-400">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®ØµØµ</p>
        </div>
        <form onsubmit="updateSpecialization(event, '${id}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</label>
                    <input type="text" id="edit-spec-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="${specialization.name}" required>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function updateSpecialization(e, id) {
    e.preventDefault();
    const name = document.getElementById('edit-spec-name').value;
    
    try {
        await db.collection('specializations').doc(id).update({
            name: name,
            updated_at: new Date().toISOString()
        });
        
        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        const index = allData.findIndex(d => d.type === 'specialization' && d.__backendId === id);
        if (index !== -1) {
            allData[index].name = name;
        }
        
        updateUI();
    } catch (error) {
        console.error("Error updating specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµ', 'error');
    }
}
        // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase
        async function addSpecialization(e) {
            e.preventDefault();
            const name = document.getElementById('spec-name').value;
            
            try {
                const docRef = await db.collection('specializations').add({
                    name: name,
                    created_at: new Date().toISOString()
                });
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­');
                hideModal();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                allData.push({
                    type: 'specialization',
                    __backendId: docRef.id,
                    name: name,
                    created_at: new Date().toISOString()
                });
                
                updateUI();
            } catch (error) {
                console.error("Error adding specialization:", error);
                showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ', 'error');
            }
        }

        async function deleteSpecialization(id) {
            try {
                await db.collection('specializations').doc(id).delete();
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ®ØµØµ');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                allData = allData.filter(d => !(d.type === 'specialization' && d.__backendId === id));
                updateUI();
            } catch (error) {
                console.error("Error deleting specialization:", error);
                showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
            }
        }

        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase
        // Ø£Ø¶ÙØª Ù…Ø«Ø§Ù„ÙŠÙ† ÙÙ‚Ø· Ù„Ù„Ø§Ø®ØªØµØ§Ø±

        function updateUI() {
            if (currentUser) {
                renderContent();
                updateSpecializationOptions();
                
                // Update group options based on specialization
                const groups = allData.filter(d => d.type === 'group');
                const groupSelect = document.getElementById('register-group');
                if (groupSelect) {
                    groupSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>' + 
                        groups.map(g => `<option value="${g.__backendId}">${g.name}</option>`).join('');
                }
            }
        }

        // Close modal on backdrop click
        document.getElementById('modal-container').addEventListener('click', function(e) {
            if (e.target === this) {
                hideModal();
            }
        });
// Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª
function showAddSpecializationModal() {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯</h2>
            <p class="text-gray-400">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
        </div>
        <form onsubmit="addSpecialization(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</label>
                    <input type="text" id="spec-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="Ù…Ø«Ù„: Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ÙˆØµÙ Ø§Ù„ØªØ®ØµØµ</label>
                    <textarea id="spec-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„ØªØ®ØµØµ..."></textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</label>
                    <select id="spec-levels" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                        ${[1,2,3,4,5,6,7,8].map(l => `<option value="${l}">${l} Ù…Ø³ØªÙˆÙŠØ§Øª</option>`).join('')}
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø¥Ø¶Ø§ÙØ©</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addSpecialization(e) {
    e.preventDefault();
    const name = document.getElementById('spec-name').value;
    const description = document.getElementById('spec-description').value;
    const levels = document.getElementById('spec-levels').value;

    try {
        const docRef = await db.collection('specializations').add({
            name: name,
            description: description || '',
            levels: parseInt(levels),
            status: 'active',
            created_at: new Date().toISOString()
        });

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();

        allData.push({
            type: 'specialization',
            __backendId: docRef.id,
            name: name,
            description: description || '',
            levels: parseInt(levels),
            status: 'active'
        });

        updateUI();
    } catch (error) {
        console.error("Error adding specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ', 'error');
    }
}

async function deleteSpecialization(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.')) return;
    
    try {
        await db.collection('specializations').doc(id).delete();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ®ØµØµ');
        
        allData = allData.filter(d => !(d.type === 'specialization' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
    }
}

async function editSpecialization(id) {
    const specialization = allData.find(d => d.type === 'specialization' && d.__backendId === id);
    if (!specialization) return;
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ®ØµØµ</h2>
            <p class="text-gray-400">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®ØµØµ</p>
        </div>
        <form onsubmit="updateSpecialization(event, '${id}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</label>
                    <input type="text" id="edit-spec-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="${specialization.name}" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ÙˆØµÙ Ø§Ù„ØªØ®ØµØµ</label>
                    <textarea id="edit-spec-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3">${specialization.description || ''}</textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function updateSpecialization(e, id) {
    e.preventDefault();
    const name = document.getElementById('edit-spec-name').value;
    const description = document.getElementById('edit-spec-description').value;
    
    try {
        await db.collection('specializations').doc(id).update({
            name: name,
            description: description || '',
            updated_at: new Date().toISOString()
        });
        
        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­');
        hideModal();
        
        const index = allData.findIndex(d => d.type === 'specialization' && d.__backendId === id);
        if (index !== -1) {
            allData[index].name = name;
            allData[index].description = description || '';
        }
        
        updateUI();
    } catch (error) {
        console.error("Error updating specialization:", error);
        showToast('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµ', 'error');
    }
}
function updateGroupOptions() {
    try {
        const specializationId = document.getElementById('register-specialization')?.value;
        console.log("Selected specialization ID:", specializationId); // Ù„Ù„ØªØ´Ø®ÙŠØµ
        
        const groups = allData.filter(d => d.type === 'group');
        console.log("All groups:", groups); // Ù„Ù„ØªØ´Ø®ÙŠØµ
        
        const filteredGroups = specializationId ? 
            groups.filter(g => g.specialization_id === specializationId) : 
            [];
        
        console.log("Filtered groups:", filteredGroups); // Ù„Ù„ØªØ´Ø®ÙŠØµ
        
        const groupSelect = document.getElementById('register-group');
        if (groupSelect) {
            groupSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>' + 
                filteredGroups.map(g => `<option value="${g.__backendId}">${g.name}</option>`).join('');
        }
    } catch (error) {
        console.error("Error in updateGroupOptions:", error);
    }
}

        // Initialize app
        initializeApp();
        
    </script>
</body>
</html>