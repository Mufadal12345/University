// بعد سطر 1070، أضف الكود التالي:

// إدارة الدكاترة (للعمادة)
function renderAdminDoctors(container) {
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">إدارة الدكاترة</h1>
                <button onclick="showAddDoctorModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    إضافة دكتور
                </button>
            </div>
            <p class="text-gray-400 mt-2">إدارة أعضاء هيئة التدريس</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">الاسم</th>
                            <th class="text-right py-3 px-4">البريد الإلكتروني</th>
                            <th class="text-right py-3 px-4">الهاتف</th>
                            <th class="text-right py-3 px-4">عدد المقررات</th>
                            <th class="text-right py-3 px-4">الحالة</th>
                            <th class="text-right py-3 px-4">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${doctors.map(doctor => {
                            const courses = allData.filter(d => d.type === 'course' && d.doctor_id === doctor.__backendId).length;
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${doctor.name}</td>
                                    <td class="py-3 px-4">${doctor.email}</td>
                                    <td class="py-3 px-4">${doctor.phone || 'غير محدد'}</td>
                                    <td class="py-3 px-4">${courses}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400">نشط</span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editDoctor('${doctor.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                تعديل
                                            </button>
                                            <button onclick="deleteDoctor('${doctor.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                حذف
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddDoctorModal() {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">إضافة دكتور جديد</h2>
            <p class="text-gray-400">أدخل بيانات الدكتور الجديد</p>
        </div>
        <form onsubmit="addDoctor(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">الاسم الكامل</label>
                    <input type="text" id="doctor-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">البريد الإلكتروني</label>
                    <input type="email" id="doctor-email" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">رقم الهاتف</label>
                    <input type="tel" id="doctor-phone" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">كلمة المرور الافتراضية</label>
                    <input type="text" id="doctor-password" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="doctor123" readonly>
                    <p class="text-xs text-gray-400 mt-1">سيتم تغييرها عند أول دخول</p>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">إضافة</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">إلغاء</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addDoctor(e) {
    e.preventDefault();
    const name = document.getElementById('doctor-name').value;
    const email = document.getElementById('doctor-email').value;
    const phone = document.getElementById('doctor-phone').value;
    const password = document.getElementById('doctor-password').value;

    try {
        // إنشاء حساب في Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // حفظ بيانات الدكتور في Firestore
        await db.collection('users').doc(user.uid).set({
            name: name,
            email: email,
            phone: phone || '',
            role: 'doctor',
            status: 'active',
            created_at: new Date().toISOString()
        });

        showToast('تم إضافة الدكتور بنجاح');
        hideModal();

        // تحديث البيانات المحلية
        allData.push({
            type: 'user',
            __backendId: user.uid,
            name: name,
            email: email,
            phone: phone || '',
            role: 'doctor',
            status: 'active'
        });

        updateUI();
    } catch (error) {
        console.error("Error adding doctor:", error);
        showToast('فشل في إضافة الدكتور', 'error');
    }
}

async function deleteDoctor(id) {
    if (!confirm('هل أنت متأكد من حذف هذا الدكتور؟')) return;
    
    try {
        // حذف من Firestore
        await db.collection('users').doc(id).delete();
        
        // حذف من Authentication (يتطلب صلاحيات إدارية في Firebase)
        // Note: هذا الجزء يتطلب صلاحيات خاصة في Firebase
        
        showToast('تم حذف الدكتور');
        
        // تحديث البيانات المحلية
        allData = allData.filter(d => !(d.type === 'user' && d.__backendId === id && d.role === 'doctor'));
        updateUI();
    } catch (error) {
        console.error("Error deleting doctor:", error);
        showToast('فشل في الحذف', 'error');
    }
}

// إدارة المقررات (للعمادة)
function renderAdminCourses(container) {
    const courses = allData.filter(d => d.type === 'course');
    const specializations = allData.filter(d => d.type === 'specialization');
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">إدارة المقررات</h1>
                <button onclick="showAddCourseModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    إضافة مقرر
                </button>
            </div>
            <p class="text-gray-400 mt-2">إدارة المواد الدراسية</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">رمز المقرر</th>
                            <th class="text-right py-3 px-4">اسم المقرر</th>
                            <th class="text-right py-3 px-4">التخصص</th>
                            <th class="text-right py-3 px-4">الدكتور</th>
                            <th class="text-right py-3 px-4">الساعات</th>
                            <th class="text-right py-3 px-4">النوع</th>
                            <th class="text-right py-3 px-4">المستوى</th>
                            <th class="text-right py-3 px-4">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${courses.map(course => {
                            const specialization = specializations.find(s => s.__backendId === course.specialization_id);
                            const doctor = doctors.find(d => d.__backendId === course.doctor_id);
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4 font-mono">${course.code || 'غير محدد'}</td>
                                    <td class="py-3 px-4">${course.name}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'غير معروف'}</td>
                                    <td class="py-3 px-4">${doctor ? doctor.name : 'غير معروف'}</td>
                                    <td class="py-3 px-4">${course.hours || 0}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                            ${course.course_type === 'theoretical' ? 'نظري' : 'عملي'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">${course.level || 1}</td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editCourse('${course.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                تعديل
                                            </button>
                                            <button onclick="deleteCourse('${course.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                حذف
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddCourseModal() {
    const specializations = allData.filter(d => d.type === 'specialization');
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">إضافة مقرر جديد</h2>
            <p class="text-gray-400">أدخل بيانات المقرر الجديد</p>
        </div>
        <form onsubmit="addCourse(event)">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">رمز المقرر</label>
                        <input type="text" id="course-code" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">اسم المقرر</label>
                        <input type="text" id="course-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">التخصص</label>
                        <select id="course-specialization" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">اختر التخصص</option>
                            ${specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">الدكتور</label>
                        <select id="course-doctor" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">اختر الدكتور</option>
                            ${doctors.map(d => `<option value="${d.__backendId}">${d.name}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">عدد الساعات</label>
                        <input type="number" id="course-hours" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" min="1" max="10" value="3" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">المستوى</label>
                        <select id="course-level" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            ${[1,2,3,4,5,6,7,8].map(l => `<option value="${l}">المستوى ${l}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">نوع المقرر</label>
                        <select id="course-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="theoretical">نظري</option>
                            <option value="practical">عملي</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">الوصف</label>
                    <textarea id="course-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3"></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">إضافة</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">إلغاء</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addCourse(e) {
    e.preventDefault();
    const code = document.getElementById('course-code').value;
    const name = document.getElementById('course-name').value;
    const specialization_id = document.getElementById('course-specialization').value;
    const doctor_id = document.getElementById('course-doctor').value;
    const hours = document.getElementById('course-hours').value;
    const level = document.getElementById('course-level').value;
    const course_type = document.getElementById('course-type').value;
    const description = document.getElementById('course-description').value;

    try {
        const docRef = await db.collection('courses').add({
            code: code,
            name: name,
            specialization_id: specialization_id,
            doctor_id: doctor_id,
            hours: parseInt(hours),
            level: parseInt(level),
            course_type: course_type,
            description: description || '',
            created_at: new Date().toISOString()
        });

        showToast('تم إضافة المقرر بنجاح');
        hideModal();

        // تحديث البيانات المحلية
        allData.push({
            type: 'course',
            __backendId: docRef.id,
            code: code,
            name: name,
            specialization_id: specialization_id,
            doctor_id: doctor_id,
            hours: parseInt(hours),
            level: parseInt(level),
            course_type: course_type,
            description: description || ''
        });

        updateUI();
    } catch (error) {
        console.error("Error adding course:", error);
        showToast('فشل في إضافة المقرر', 'error');
    }
}

async function deleteCourse(id) {
    if (!confirm('هل أنت متأكد من حذف هذا المقرر؟')) return;
    
    try {
        await db.collection('courses').doc(id).delete();
        showToast('تم حذف المقرر');
        
        allData = allData.filter(d => !(d.type === 'course' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting course:", error);
        showToast('فشل في الحذف', 'error');
    }
}

// إدارة الجداول (للعمادة)
function renderAdminSchedules(container) {
    const schedules = allData.filter(d => d.type === 'schedule');
    const courses = allData.filter(d => d.type === 'course');
    const groups = allData.filter(d => d.type === 'group');
    const rooms = allData.filter(d => d.type === 'room');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">إدارة الجداول</h1>
                <button onclick="showAddScheduleModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    إضافة محاضرة
                </button>
            </div>
            <p class="text-gray-400 mt-2">جدولة المحاضرات النظرية والعملية</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="grid grid-cols-7 gap-4 mb-4">
                ${['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'].map(day => `
                    <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                `).join('')}
            </div>
            <div class="grid grid-cols-7 gap-4">
                ${Array.from({length: 7}, (_, dayIndex) => {
                    const daySchedules = schedules.filter(s => s.day === dayIndex);
                    return `
                        <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                            ${daySchedules.map(schedule => {
                                const course = courses.find(c => c.__backendId === schedule.course_id);
                                const group = groups.find(g => g.__backendId === schedule.group_id);
                                const room = rooms.find(r => r.__backendId === schedule.room_id);
                                return `
                                    <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                        <div class="font-medium">${course ? course.name : 'غير معروف'}</div>
                                        <div class="text-sm text-gray-400">${group ? group.name : 'غير معروف'}</div>
                                        <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-xs text-gray-500">${room ? room.name : 'غير معروف'}</div>
                                        <div class="flex gap-1 mt-2">
                                            <button onclick="editSchedule('${schedule.__backendId}')" class="text-xs px-2 py-1 rounded bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                تعديل
                                            </button>
                                            <button onclick="deleteSchedule('${schedule.__backendId}')" class="text-xs px-2 py-1 rounded bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                حذف
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function showAddScheduleModal() {
    const courses = allData.filter(d => d.type === 'course');
    const groups = allData.filter(d => d.type === 'group');
    const rooms = allData.filter(d => d.type === 'room');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">إضافة محاضرة جديدة</h2>
            <p class="text-gray-400">جدولة محاضرة في الجدول</p>
        </div>
        <form onsubmit="addSchedule(event)">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">المقرر</label>
                        <select id="schedule-course" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">اختر المقرر</option>
                            ${courses.map(c => `<option value="${c.__backendId}">${c.code} - ${c.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">المجموعة</label>
                        <select id="schedule-group" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">اختر المجموعة</option>
                            ${groups.map(g => `<option value="${g.__backendId}">${g.name}</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">اليوم</label>
                        <select id="schedule-day" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="0">الأحد</option>
                            <option value="1">الاثنين</option>
                            <option value="2">الثلاثاء</option>
                            <option value="3">الأربعاء</option>
                            <option value="4">الخميس</option>
                            <option value="5">الجمعة</option>
                            <option value="6">السبت</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">القاعة</label>
                        <select id="schedule-room" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">اختر القاعة</option>
                            ${rooms.map(r => `<option value="${r.__backendId}">${r.name} (${r.type === 'lecture' ? 'قاعة' : 'معمل'})</option>`).join('')}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">وقت البداية</label>
                        <input type="time" id="schedule-start" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required value="08:00">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">وقت النهاية</label>
                        <input type="time" id="schedule-end" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required value="10:00">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">نوع المحاضرة</label>
                    <select id="schedule-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                        <option value="theoretical">نظري</option>
                        <option value="practical">عملي</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">إضافة</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">إلغاء</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addSchedule(e) {
    e.preventDefault();
    const course_id = document.getElementById('schedule-course').value;
    const group_id = document.getElementById('schedule-group').value;
    const day = parseInt(document.getElementById('schedule-day').value);
    const room_id = document.getElementById('schedule-room').value;
    const start_time = document.getElementById('schedule-start').value;
    const end_time = document.getElementById('schedule-end').value;
    const type = document.getElementById('schedule-type').value;

    try {
        const docRef = await db.collection('schedules').add({
            course_id: course_id,
            group_id: group_id,
            day: day,
            room_id: room_id,
            start_time: start_time,
            end_time: end_time,
            type: type,
            created_at: new Date().toISOString()
        });

        showToast('تم إضافة المحاضرة بنجاح');
        hideModal();

        // تحديث البيانات المحلية
        allData.push({
            type: 'schedule',
            __backendId: docRef.id,
            course_id: course_id,
            group_id: group_id,
            day: day,
            room_id: room_id,
            start_time: start_time,
            end_time: end_time,
            type: type
        });

        updateUI();
    } catch (error) {
        console.error("Error adding schedule:", error);
        showToast('فشل في إضافة المحاضرة', 'error');
    }
}

async function deleteSchedule(id) {
    if (!confirm('هل أنت متأكد من حذف هذه المحاضرة؟')) return;
    
    try {
        await db.collection('schedules').doc(id).delete();
        showToast('تم حذف المحاضرة');
        
        allData = allData.filter(d => !(d.type === 'schedule' && d.__backendId === id));
        updateUI();
    } catch (error) {
        console.error("Error deleting schedule:", error);
        showToast('فشل في الحذف', 'error');
    }
}

// إدارة المجموعات (للعمادة)
function renderAdminGroups(container) {
    const groups = allData.filter(d => d.type === 'group');
    const specializations = allData.filter(d => d.type === 'specialization');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">إدارة المجموعات</h1>
                <button onclick="showAddGroupModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    إضافة مجموعة
                </button>
            </div>
            <p class="text-gray-400 mt-2">إدارة مجموعات الطلاب</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">اسم المجموعة</th>
                            <th class="text-right py-3 px-4">التخصص</th>
                            <th class="text-right py-3 px-4">عدد الطلاب</th>
                            <th class="text-right py-3 px-4">السعة</th>
                            <th class="text-right py-3 px-4">الحالة</th>
                            <th class="text-right py-3 px-4">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${groups.map(group => {
                            const specialization = specializations.find(s => s.__backendId === group.specialization_id);
                            const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.group_id === group.__backendId).length;
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${group.name}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'غير معروف'}</td>
                                    <td class="py-3 px-4">${students}</td>
                                    <td class="py-3 px-4">${group.capacity || 30}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${students < (group.capacity || 30) ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                                            ${students < (group.capacity || 30) ? 'متاحة' : 'ممتلئة'}
                                        </span>
                                    </td>
                                    <td class="py-3 px-4">
                                        <div class="flex gap-2">
                                            <button onclick="editGroup('${group.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                                تعديل
                                            </button>
                                            <button onclick="deleteGroup('${group.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                                حذف
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function showAddGroupModal() {
    const specializations = allData.filter(d => d.type === 'specialization');
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">إضافة مجموعة جديدة</h2>
            <p class="text-gray-400">أدخل بيانات المجموعة الجديدة</p>
        </div>
        <form onsubmit="addGroup(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">اسم المجموعة</label>
                    <input type="text" id="group-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="مثل: المجموعة أ">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">التخصص</label>
                        <select id="group-specialization" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required>
                            <option value="">اختر التخصص</option>
                            ${specializations.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">السعة</label>
                        <input type="number" id="group-capacity" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" min="1" max="100" value="30" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">الوصف</label>
                    <textarea id="group-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="2" placeholder="وصف المجموعة..."></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">إضافة</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">إلغاء</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function addGroup(e) {
    e.preventDefault();
    const name = document.getElementById('group-name').value;
    const specialization_id = document.getElementById('group-specialization').value;
    const capacity = document.getElementById('group-capacity').value;
    const description = document.getElementById('group-description').value;

    try {
        const docRef = await db.collection('groups').add({
            name: name,
            specialization_id: specialization_id,
            capacity: parseInt(capacity),
            description: description || '',
            created_at: new Date().toISOString()
        });

        showToast('تم إضافة المجموعة بنجاح');
        hideModal();

        // تحديث البيانات المحلية
        allData.push({
            type: 'group',
            __backendId: docRef.id,
            name: name,
            specialization_id: specialization_id,
            capacity: parseInt(capacity),
            description: description || ''
        });

        updateUI();
    } catch (error) {
        console.error("Error adding group:", error);
        showToast('فشل في إضافة المجموعة', 'error');
    }
}

// إدارة القاعات (للعمادة)
function renderAdminRooms(container) {
    const rooms = allData.filter(d => d.type === 'room');
    
    container.innerHTML = `
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">إدارة القاعات</h1>
                <button onclick="showAddRoomModal()" class="btn-primary px-6 py-3 rounded-xl font-medium">
                    إضافة قاعة
                </button>
            </div>
            <p class="text-gray-400 mt-2">إدارة القاعات والمعامل</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">اسم القاعة</th>
                            <th class="text-right py-3 px-4">النوع</th>
                            <th class="text-right py-3 px-4">السعة</th>
                            <th class="text-right py-3 px-4">الموقع</th>
                            <th class="text-right py-3 px-4">المعدات</th>
                            <th class="text-right py-3 px-4">الحالة</th>
                            <th class="text-right py-3 px-4">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rooms.map(room => `
                            <tr class="border-b border-white/5 hover:bg-white/5">
                                <td class="py-3 px-4">${room.name}</td>
                                <td class="py-3 px-4">
                                    <span class="px-2 py-1 rounded-full text-xs ${room.type === 'lecture' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                        ${room.type === 'lecture' ? 'قاعة محاضرات' : 'معمل'}
                                    </span>
                                </td>
                                <td class="py-3 px-4">${room.capacity}</td>
                                <td class="py-3 px-4">${room.location || 'غير محدد'}</td>
                                <td class="py-3 px-4">${room.equipment || 'لا يوجد'}</td>
                                <td class="py-3 px-4">
                                    <span class="px-2 py-1 rounded-full text-xs ${room.status === 'available' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                                        ${room.status === 'available' ? 'متاحة' : 'غير متاحة'}
                                    </span>
                                </td>
                                <td class="py-3 px-4">
                                    <div class="flex gap-2">
                                        <button onclick="editRoom('${room.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                            تعديل
                                        </button>
                                        <button onclick="deleteRoom('${room.__backendId}')" class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30">
                                            حذف
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

// واجهة الدكتور
function renderDoctorDashboard(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const doctorSchedules = allData.filter(d => d.type === 'schedule');
    const today = new Date().getDay(); // 0-6 where 0 is Sunday
    
    const todaySchedules = doctorSchedules.filter(schedule => {
        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
        return course && course.doctor_id === currentUser.id && schedule.day === today;
    });

    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">مرحباً دكتور ${currentUser.name}</h1>
            <p class="text-gray-400">لوحة تحكم الدكتور</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${doctorCourses.length}</span>
                </div>
                <h3 class="font-semibold text-lg">المقررات</h3>
                <p class="text-gray-400 text-sm">المواد المسندة إليك</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${todaySchedules.length}</span>
                </div>
                <h3 class="font-semibold text-lg">محاضرات اليوم</h3>
                <p class="text-gray-400 text-sm">المحاضرات المجدولة اليوم</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">85%</span>
                </div>
                <h3 class="font-semibold text-lg">نسبة الحضور</h3>
                <p class="text-gray-400 text-sm">متوسط حضور الطلاب</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">محاضرات اليوم</h2>
                <div class="space-y-3">
                    ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                        const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                        const group = allData.find(g => g.type === 'group' && g.__backendId === schedule.group_id);
                        
                        return `
                            <div class="p-3 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course ? course.name : 'غير معروف'}</h3>
                                        <p class="text-sm text-gray-400">${group ? group.name : 'غير معروف'} - ${room ? room.name : 'غير معروف'}</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-medium">${schedule.start_time} - ${schedule.end_time}</div>
                                        <button onclick="takeAttendance('${schedule.__backendId}')" class="mt-2 px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                            تسجيل حضور
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('') : `
                        <div class="text-center py-8 text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p>لا توجد محاضرات اليوم</p>
                        </div>
                    `}
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">أحدث المقررات</h2>
                <div class="space-y-3">
                    ${doctorCourses.slice(0, 3).map(course => {
                        const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === course.specialization_id);
                        const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.specialization_id === course.specialization_id).length;
                        
                        return `
                            <div class="p-3 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course.name}</h3>
                                        <p class="text-sm text-gray-400">${specialization ? specialization.name : ''} - ${course.code}</p>
                                    </div>
                                    <span class="px-2 py-1 rounded-full text-xs bg-blue-500/20 text-blue-400">
                                        ${course.course_type === 'theoretical' ? 'نظري' : 'عملي'}
                                    </span>
                                </div>
                                <div class="flex items-center justify-between mt-3 text-sm">
                                    <span class="text-gray-400">${students} طالب</span>
                                    <span class="text-gray-400">${course.hours} ساعة</span>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>
    `;
}

// واجهة الطالب
function renderStudentDashboard(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    const today = new Date().getDay();
    const todaySchedules = studentSchedules.filter(schedule => schedule.day === today);
    const studentCourses = allData.filter(d => d.type === 'course');
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">مرحباً ${currentUser.name}</h1>
            <p class="text-gray-400">لوحة تحكم الطالب</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${todaySchedules.length}</span>
                </div>
                <h3 class="font-semibold text-lg">محاضرات اليوم</h3>
                <p class="text-gray-400 text-sm">المحاضرات المجدولة اليوم</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">${studentCourses.length}</span>
                </div>
                <h3 class="font-semibold text-lg">المقررات</h3>
                <p class="text-gray-400 text-sm">المواد المسجلة</p>
            </div>
            
            <div class="glass-card rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                    </div>
                    <span class="text-3xl font-bold">92%</span>
                </div>
                <h3 class="font-semibold text-lg">نسبة الحضور</h3>
                <p class="text-gray-400 text-sm">حضورك الشخصي</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">جدول اليوم</h2>
                <div class="space-y-3">
                    ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                        const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                        const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                        
                        return `
                            <div class="p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-medium">${course ? course.name : 'غير معروف'}</h3>
                                        <p class="text-sm text-gray-400">${doctor ? doctor.name : 'غير معروف'}</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-medium">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-sm text-gray-400">${room ? room.name : 'غير معروف'}</div>
                                    </div>
                                </div>
                                <div class="mt-3 flex items-center justify-between text-sm">
                                    <span class="px-2 py-1 rounded-full ${schedule.type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                        ${schedule.type === 'theoretical' ? 'نظري' : 'عملي'}
                                    </span>
                                    <button onclick="confirmAttendance('${schedule.__backendId}')" class="px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                        تأكيد الحضور
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('') : `
                        <div class="text-center py-8 text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p>لا توجد محاضرات اليوم</p>
                        </div>
                    `}
                </div>
            </div>
            
            <div class="glasscard rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">معلومات التخصص</h2>
                ${(() => {
                    const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === currentUser.specialization_id);
                    const group = allData.find(g => g.type === 'group' && g.__backendId === currentUser.group_id);
                    
                    if (specialization) {
                        return `
                            <div class="space-y-4">
                                <div class="p-4 rounded-lg bg-white/5">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h3 class="font-medium">${specialization.name}</h3>
                                            <p class="text-sm text-gray-400">تخصصك الأكاديمي</p>
                                        </div>
                                    </div>
                                </div>
                                
                                ${group ? `
                                    <div class="p-4 rounded-lg bg-white/5">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h3 class="font-medium">${group.name}</h3>
                                                <p class="text-sm text-gray-400">مجموعتك الدراسية</p>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                    return '<p class="text-gray-400">لا توجد معلومات متاحة</p>';
                })()}
            </div>
        </div>
    `;
}

// وظائف مساعدة
function takeAttendance(scheduleId) {
    showToast('تم فتح صفحة تسجيل الحضور', 'info');
    // هنا يمكن تنفيذ منطق تسجيل الحضور
}

function confirmAttendance(scheduleId) {
    showToast('تم تأكيد حضورك', 'success');
}

// تحديث دالة renderAdminContent
function renderAdminContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderAdminDashboard(container);
            break;
        case 'specializations':
            renderAdminSpecializations(container);
            break;
        case 'doctors':
            renderAdminDoctors(container);
            break;
        case 'courses':
            renderAdminCourses(container);
            break;
        case 'schedules':
            renderAdminSchedules(container);
            break;
        case 'groups':
            renderAdminGroups(container);
            break;
        case 'rooms':
            renderAdminRooms(container);
            break;
        case 'reports':
            renderAdminReports(container);
            break;
        default:
            renderAdminDashboard(container);
    }
}

function renderAdminReports(container) {
    const specializations = allData.filter(d => d.type === 'specialization').length;
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor').length;
    const students = allData.filter(d => d.type === 'user' && d.role === 'student').length;
    const courses = allData.filter(d => d.type === 'course').length;
    const schedules = allData.filter(d => d.type === 'schedule').length;
    const groups = allData.filter(d => d.type === 'group').length;
    const rooms = allData.filter(d => d.type === 'room').length;
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">التقارير والإحصائيات</h1>
            <p class="text-gray-400">إحصائيات شاملة عن النظام</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">إحصائيات النظام</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>عدد التخصصات</span>
                        <span class="font-bold">${specializations}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>عدد الدكاترة</span>
                        <span class="font-bold">${doctors}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>عدد الطلاب</span>
                        <span class="font-bold">${students}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>عدد المقررات</span>
                        <span class="font-bold">${courses}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>عدد المجموعات</span>
                        <span class="font-bold">${groups}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>عدد القاعات</span>
                        <span class="font-bold">${rooms}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                        <span>عدد المحاضرات</span>
                        <span class="font-bold">${schedules}</span>
                    </div>
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">تقارير الحضور</h2>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>نسبة الحضور العامة</span>
                            <span>85%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-teal-500" style="width: 85%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>نسبة الحضور النظرية</span>
                            <span>88%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-500" style="width: 88%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <span>نسبة الحضور العملية</span>
                            <span>82%</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-orange-500" style="width: 82%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h3 class="font-medium mb-3">أعلى 5 مقررات حضوراً</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>هياكل البيانات</span>
                            <span class="text-teal-400">94%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>قواعد البيانات</span>
                            <span class="text-teal-400">91%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>برمجة الويب</span>
                            <span class="text-teal-400">89%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>الشبكات</span>
                            <span class="text-teal-400">87%</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                            <span>الرياضيات</span>
                            <span class="text-teal-400">85%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// تحديث دالة renderDoctorContent
function renderDoctorContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderDoctorDashboard(container);
            break;
        case 'my-schedule':
            renderDoctorSchedule(container);
            break;
        case 'my-courses':
            renderDoctorCourses(container);
            break;
        case 'my-students':
            renderDoctorStudents(container);
            break;
        case 'attendance':
            renderDoctorAttendance(container);
            break;
        default:
            renderDoctorDashboard(container);
    }
}

function renderDoctorSchedule(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const schedules = allData.filter(d => d.type === 'schedule');
    const doctorSchedules = schedules.filter(schedule => {
        const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
        return course && course.doctor_id === currentUser.id;
    });
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">جدولي الأسبوعي</h1>
            <p class="text-gray-400">محاضراتي المجدولة لهذا الأسبوع</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="grid grid-cols-7 gap-4 mb-4">
                ${['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'].map(day => `
                    <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                `).join('')}
            </div>
            <div class="grid grid-cols-7 gap-4">
                ${Array.from({length: 7}, (_, dayIndex) => {
                    const daySchedules = doctorSchedules.filter(s => s.day === dayIndex);
                    return `
                        <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                            ${daySchedules.map(schedule => {
                                const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                                const group = allData.find(g => g.type === 'group' && g.__backendId === schedule.group_id);
                                const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                                return `
                                    <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                        <div class="font-medium">${course ? course.name : 'غير معروف'}</div>
                                        <div class="text-sm text-gray-400">${group ? group.name : 'غير معروف'}</div>
                                        <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-xs text-gray-500">${room ? room.name : 'غير معروف'}</div>
                                        <button onclick="takeAttendance('${schedule.__backendId}')" class="w-full mt-2 px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                            تسجيل حضور
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function renderDoctorCourses(container) {
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">المقررات المسندة إلي</h1>
            <p class="text-gray-400">جميع المواد التي أقوم بتدريسها</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${doctorCourses.map(course => {
                const specialization = allData.find(d => d.type === 'specialization' && d.__backendId === course.specialization_id);
                const students = allData.filter(d => d.type === 'user' && d.role === 'student' && d.specialization_id === course.specialization_id).length;
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'} flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <span class="text-2xl font-bold">${course.hours || 0}</span>
                        </div>
                        <h3 class="font-semibold text-lg mb-2">${course.name}</h3>
                        <p class="text-gray-400 text-sm mb-4">${specialization ? specialization.name : ''}</p>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-400">${course.code || 'لا يوجد رمز'}</span>
                            <span class="px-2 py-1 rounded-full ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                ${course.course_type === 'theoretical' ? 'نظري' : 'عملي'}
                            </span>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400">عدد الطلاب:</span>
                                <span class="font-medium">${students}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">المستوى:</span>
                                <span class="font-medium">${course.level || 1}</span>
                            </div>
                        </div>
                        <button onclick="uploadCourseMaterial('${course.__backendId}')" class="w-full mt-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            رفع مواد دراسية
                        </button>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function renderDoctorStudents(container) {
    // طلاب الدكتور بناءً على المقررات التي يدرسها
    const doctorCourses = allData.filter(d => d.type === 'course' && d.doctor_id === currentUser.id);
    const students = allData.filter(d => d.type === 'user' && d.role === 'student');
    
    // تجميع الطلاب الذين يدرسون مقررات هذا الدكتور
    const doctorStudents = students.filter(student => {
        // التحقق إذا كان الطالب في تخصص يدرس فيه الدكتور مقرراً
        return doctorCourses.some(course => course.specialization_id === student.specialization_id);
    });
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">قائمة الطلاب</h1>
            <p class="text-gray-400">طلابي في المقررات المختلفة</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">اسم الطالب</th>
                            <th class="text-right py-3 px-4">البريد الإلكتروني</th>
                            <th class="text-right py-3 px-4">التخصص</th>
                            <th class="text-right py-3 px-4">المجموعة</th>
                            <th class="text-right py-3 px-4">نسبة الحضور</th>
                            <th class="text-right py-3 px-4">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${doctorStudents.map(student => {
                            const specialization = allData.find(s => s.type === 'specialization' && s.__backendId === student.specialization_id);
                            const group = allData.find(g => g.type === 'group' && g.__backendId === student.group_id);
                            
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${student.name}</td>
                                    <td class="py-3 px-4">${student.email}</td>
                                    <td class="py-3 px-4">${specialization ? specialization.name : 'غير معروف'}</td>
                                    <td class="py-3 px-4">${group ? group.name : 'غير معروف'}</td>
                                    <td class="py-3 px-4">
                                        <div class="flex items-center gap-2">
                                            <div class="w-16 h-2 bg-white/10 rounded-full overflow-hidden">
                                                <div class="h-full bg-teal-500" style="width: ${Math.floor(Math.random() * 30) + 70}%"></div>
                                            </div>
                                            <span>${Math.floor(Math.random() * 30) + 70}%</span>
                                        </div>
                                    </td>
                                    <td class="py-3 px-4">
                                        <button onclick="viewStudentDetails('${student.__backendId}')" class="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                            عرض التفاصيل
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function renderDoctorAttendance(container) {
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">نظام الحضور والغياب</h1>
            <p class="text-gray-400">تسجيل حضور طلابك</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">المحاضرات القادمة</h2>
                <div class="space-y-3">
                    ${Array.from({length: 3}).map((_, i) => {
                        const courses = ['هياكل البيانات', 'قواعد البيانات', 'برمجة الويب'];
                        const times = ['08:00 - 10:00', '10:00 - 12:00', '14:00 - 16:00'];
                        const rooms = ['قاعة 101', 'معمل 203', 'قاعة 305'];
                        
                        return `
                            <div class="p-4 rounded-lg bg-white/5 border border-white/10">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-medium">${courses[i]}</h3>
                                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                        ${times[i]}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-400 mb-3">${rooms[i]}</p>
                                <button onclick="startAttendanceSession(${i})" class="w-full py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                    بدء تسجيل الحضور
                                </button>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">إحصائيات الحضور</h2>
                <div class="space-y-6">
                    <div>
                        <h3 class="font-medium mb-2">نسبة الحضور حسب المقرر</h3>
                        <div class="space-y-3">
                            ${['هياكل البيانات', 'قواعد البيانات', 'برمجة الويب', 'الشبكات', 'الرياضيات'].map((course, i) => {
                                const percentage = [94, 91, 89, 87, 85][i];
                                return `
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm">${course}</span>
                                            <span class="text-sm">${percentage}%</span>
                                        </div>
                                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-teal-500" style="width: ${percentage}%"></div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-medium mb-2">آخر تسجيلات الحضور</h3>
                        <div class="space-y-2">
                            ${['اليوم 08:00', 'أمس 14:00', '٢٠/١٠ 10:00'].map((time, i) => {
                                const courses = ['هياكل البيانات', 'قواعد البيانات', 'برمجة الويب'];
                                return `
                                    <div class="flex justify-between items-center p-2 rounded-lg bg-white/5">
                                        <span>${courses[i]}</span>
                                        <span class="text-sm text-gray-400">${time}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function uploadCourseMaterial(courseId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">رفع مواد دراسية</h2>
            <p class="text-gray-400">أرفع المواد التعليمية للطلاب</p>
        </div>
        <form onsubmit="handleMaterialUpload(event, '${courseId}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">عنوان المادة</label>
                    <input type="text" id="material-title" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="مثل: محاضرة الأسبوع الأول">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">وصف المادة</label>
                    <textarea id="material-description" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="3" placeholder="وصف مختصر للمادة..."></textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">نوع المادة</label>
                    <select id="material-type" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none">
                        <option value="lecture">محاضرة</option>
                        <option value="assignment">واجب</option>
                        <option value="exam">امتحان</option>
                        <option value="resource">مرجع</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">رفع ملف</label>
                    <div class="border-2 border-dashed border-white/20 rounded-xl p-6 text-center">
                        <svg class="w-12 h-12 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <p class="text-gray-400 mb-2">اسحب وأفلت الملف هنا أو</p>
                        <input type="file" id="material-file" class="hidden" accept=".pdf,.doc,.docx,.ppt,.pptx">
                        <label for="material-file" class="cursor-pointer px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            اختر ملف
                        </label>
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">رفع</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">إلغاء</button>
            </div>
        </form>
    `;
    showModal(content);
}

function handleMaterialUpload(e, courseId) {
    e.preventDefault();
    showToast('تم رفع المادة الدراسية بنجاح', 'success');
    hideModal();
}

function startAttendanceSession(index) {
    showToast(`بدأت جلسة تسجيل الحضور للمحاضرة ${index + 1}`, 'info');
}

function viewStudentDetails(studentId) {
    const student = allData.find(d => d.type === 'user' && d.__backendId === studentId);
    if (!student) return;
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">تفاصيل الطالب</h2>
            <p class="text-gray-400">معلومات الطالب وأداؤه</p>
        </div>
        
        <div class="space-y-6">
            <div class="flex items-center gap-4 p-4 rounded-xl bg-white/5">
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                    <span class="text-xl font-bold">${student.name.charAt(0)}</span>
                </div>
                <div>
                    <h3 class="font-bold text-lg">${student.name}</h3>
                    <p class="text-gray-400">${student.email}</p>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="p-4 rounded-xl bg-white/5">
                    <p class="text-gray-400 text-sm">نسبة الحضور</p>
                    <p class="text-2xl font-bold text-teal-400">${Math.floor(Math.random() * 30) + 70}%</p>
                </div>
                <div class="p-4 rounded-xl bg-white/5">
                    <p class="text-gray-400 text-sm">عدد الغيابات</p>
                    <p class="text-2xl font-bold text-orange-400">${Math.floor(Math.random() * 5)}</p>
                </div>
            </div>
            
            <div>
                <h3 class="font-medium mb-3">مقررات الطالب</h3>
                <div class="space-y-2">
                    ${['هياكل البيانات', 'قواعد البيانات', 'برمجة الويب'].map(course => `
                        <div class="flex justify-between items-center p-3 rounded-lg bg-white/5">
                            <span>${course}</span>
                            <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                ${Math.floor(Math.random() * 30) + 70}%
                            </span>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                إغلاق
            </button>
        </div>
    `;
    showModal(content);
}

// تحديث دالة renderStudentContent
function renderStudentContent(container) {
    switch(currentView) {
        case 'dashboard':
            renderStudentDashboard(container);
            break;
        case 'full-schedule':
            renderStudentFullSchedule(container);
            break;
        case 'today-schedule':
            renderStudentTodaySchedule(container);
            break;
        case 'my-courses':
            renderStudentCourses(container);
            break;
        case 'my-doctors':
            renderStudentDoctors(container);
            break;
        case 'my-attendance':
            renderStudentAttendance(container);
            break;
        default:
            renderStudentDashboard(container);
    }
}

function renderStudentFullSchedule(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">الجدول الدراسي الكامل</h1>
            <p class="text-gray-400">جميع المحاضرات الأسبوعية</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="grid grid-cols-7 gap-4 mb-4">
                ${['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'].map(day => `
                    <div class="text-center py-2 font-medium border-b border-teal-500/30">${day}</div>
                `).join('')}
            </div>
            <div class="grid grid-cols-7 gap-4">
                ${Array.from({length: 7}, (_, dayIndex) => {
                    const daySchedules = studentSchedules.filter(s => s.day === dayIndex);
                    return `
                        <div class="min-h-[200px] schedule-cell rounded-xl p-3">
                            ${daySchedules.map(schedule => {
                                const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                                const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                                const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                                return `
                                    <div class="lecture-card mb-2 p-3 rounded-lg ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                                        <div class="font-medium">${course ? course.name : 'غير معروف'}</div>
                                        <div class="text-sm text-gray-400">${doctor ? doctor.name : 'غير معروف'}</div>
                                        <div class="text-xs text-gray-500 mt-1">${schedule.start_time} - ${schedule.end_time}</div>
                                        <div class="text-xs text-gray-500">${room ? room.name : 'غير معروف'}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function renderStudentTodaySchedule(container) {
    const studentSchedules = allData.filter(d => d.type === 'schedule' && d.group_id === currentUser.group_id);
    const today = new Date().getDay();
    const todaySchedules = studentSchedules.filter(schedule => schedule.day === today);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">جدول اليوم</h1>
            <p class="text-gray-400">محاضرات اليوم الدراسي</p>
        </div>
        
        <div class="glass-card rounded-2xl p-6">
            <div class="space-y-4">
                ${todaySchedules.length > 0 ? todaySchedules.map(schedule => {
                    const course = allData.find(c => c.type === 'course' && c.__backendId === schedule.course_id);
                    const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                    const room = allData.find(r => r.type === 'room' && r.__backendId === schedule.room_id);
                    
                    // محاكاة حالة حضور الدكتور
                    const isDoctorPresent = Math.random() > 0.2; // 80% حضور
                    
                    return `
                        <div class="p-4 rounded-xl ${schedule.type === 'theoretical' ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-orange-500/10 border border-orange-500/20'}">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="font-bold text-lg">${course ? course.name : 'غير معروف'}</h3>
                                    <p class="text-gray-400">${doctor ? doctor.name : 'غير معروف'}</p>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-xl">${schedule.start_time} - ${schedule.end_time}</div>
                                    <div class="text-sm text-gray-400">${room ? room.name : 'غير معروف'}</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between mt-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full ${isDoctorPresent ? 'bg-green-500 pulse-dot' : 'bg-red-500'}"></div>
                                    <span class="text-sm ${isDoctorPresent ? 'text-green-400' : 'text-red-400'}">
                                        ${isDoctorPresent ? 'الدكتور حاضر' : 'الدكتور غائب'}
                                    </span>
                                </div>
                                
                                <div class="flex gap-2">
                                    <button onclick="confirmAttendance('${schedule.__backendId}')" class="px-4 py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                        تأكيد حضوري
                                    </button>
                                    <button onclick="viewCourseMaterials('${course ? course.__backendId : ''}')" class="px-4 py-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30">
                                        المواد الدراسية
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('') : `
                    <div class="text-center py-12">
                        <svg class="w-20 h-20 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <h3 class="text-xl font-medium mb-2">لا توجد محاضرات اليوم</h3>
                        <p class="text-gray-400">استمتع بيوم إجازة!</p>
                    </div>
                `}
            </div>
        </div>
    `;
}

function renderStudentCourses(container) {
    // مقررات الطالب بناءً على تخصصه
    const studentCourses = allData.filter(d => d.type === 'course' && d.specialization_id === currentUser.specialization_id);
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">مقرراتي الدراسية</h1>
            <p class="text-gray-400">جميع المواد المسجلة في تخصصي</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${studentCourses.map(course => {
                const doctor = allData.find(d => d.type === 'user' && d.role === 'doctor' && d.__backendId === course.doctor_id);
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'} flex items-center justify-center">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <span class="text-2xl font-bold">${course.hours || 0}</span>
                        </div>
                        <h3 class="font-semibold text-lg mb-2">${course.name}</h3>
                        <p class="text-gray-400 text-sm mb-4">${doctor ? doctor.name : 'غير معروف'}</p>
                        <div class="flex items-center justify-between text-sm mb-4">
                            <span class="text-gray-400">${course.code || 'لا يوجد رمز'}</span>
                            <span class="px-2 py-1 rounded-full ${course.course_type === 'theoretical' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'}">
                                ${course.course_type === 'theoretical' ? 'نظري' : 'عملي'}
                            </span>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400">المستوى:</span>
                                <span class="font-medium">${course.level || 1}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">الساعات:</span>
                                <span class="font-medium">${course.hours || 0} ساعة</span>
                            </div>
                        </div>
                        <button onclick="viewCourseMaterials('${course.__backendId}')" class="w-full mt-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all">
                            عرض المواد الدراسية
                        </button>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function viewCourseMaterials(courseId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">المواد الدراسية</h2>
            <p class="text-gray-400">المراجع والمواد التعليمية</p>
        </div>
        
        <div class="space-y-4">
            ${Array.from({length: 3}).map((_, i) => {
                const materials = ['محاضرة الأسبوع الأول', 'واجب الهياكل', 'مرجع قواعد البيانات'];
                const types = ['PDF', 'DOC', 'PDF'];
                const dates = ['اليوم', 'أمس', 'منذ 3 أيام'];
                
                return `
                    <div class="p-4 rounded-xl bg-white/5 border border-white/10">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-medium">${materials[i]}</h3>
                            <span class="px-2 py-1 rounded-full text-xs bg-blue-500/20 text-blue-400">
                                ${types[i]}
                            </span>
                        </div>
                        <p class="text-sm text-gray-400 mb-3">مادة تعليمية مقدمة من الدكتور</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">${dates[i]}</span>
                            <button class="px-3 py-1 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30">
                                تحميل
                            </button>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                إغلاق
            </button>
        </div>
    `;
    showModal(content);
}

function renderStudentDoctors(container) {
    // دكاترة الطالب بناءً على المقررات في تخصصه
    const studentCourses = allData.filter(d => d.type === 'course' && d.specialization_id === currentUser.specialization_id);
    const doctorIds = [...new Set(studentCourses.map(course => course.doctor_id))];
    const doctors = allData.filter(d => d.type === 'user' && d.role === 'doctor' && doctorIds.includes(d.__backendId));
    
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">دكاترتي</h1>
            <p class="text-gray-400">أعضاء هيئة التدريس في تخصصي</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${doctors.map(doctor => {
                const doctorCourses = studentCourses.filter(course => course.doctor_id === doctor.__backendId);
                
                return `
                    <div class="glass-card rounded-2xl p-6 card-hover">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-16 h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center">
                                <span class="text-xl font-bold">${doctor.name.charAt(0)}</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg">${doctor.name}</h3>
                                <p class="text-gray-400 text-sm">${doctor.email}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="p-3 rounded-lg bg-white/5">
                                <p class="text-gray-400 text-sm mb-1">عدد المقررات</p>
                                <p class="font-medium">${doctorCourses.length} مقرر</p>
                            </div>
                            
                            <div class="p-3 rounded-lg bg-white/5">
                                <p class="text-gray-400 text-sm mb-1">التواصل</p>
                                <div class="flex gap-2">
                                    <button onclick="contactDoctor('${doctor.__backendId}')" class="flex-1 py-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 text-sm">
                                        إرسال رسالة
                                    </button>
                                    <button onclick="viewDoctorSchedule('${doctor.__backendId}')" class="flex-1 py-2 rounded-lg bg-teal-500/20 text-teal-400 hover:bg-teal-500/30 text-sm">
                                        مواعيد المكتب
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-white/10">
                            <p class="text-gray-400 text-sm mb-2">المقررات:</p>
                            <div class="flex flex-wrap gap-1">
                                ${doctorCourses.slice(0, 3).map(course => `
                                    <span class="px-2 py-1 rounded-full text-xs bg-white/10">
                                        ${course.name}
                                    </span>
                                `).join('')}
                                ${doctorCourses.length > 3 ? `
                                    <span class="px-2 py-1 rounded-full text-xs bg-white/10">
                                        +${doctorCourses.length - 3} أكثر
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function renderStudentAttendance(container) {
    container.innerHTML = `
        <div class="mb-8">
            <h1 class="text-3xl font-bold">سجل الحضور والغياب</h1>
            <p class="text-gray-400">متابعة حضورك في المقررات</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">إحصائيات الحضور</h2>
                <div class="space-y-6">
                    <div class="text-center">
                        <div class="inline-flex items-center justify-center w-40 h-40 rounded-full border-8 border-teal-500/20 relative">
                            <div class="absolute inset-0 rounded-full border-8 border-teal-500" style="clip-path: polygon(0 0, 100% 0, 100% 85%, 0 85%);"></div>
                            <div class="text-center">
                                <div class="text-4xl font-bold">92%</div>
                                <div class="text-gray-400 text-sm">نسبة الحضور</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-teal-400">45</div>
                            <div class="text-gray-400 text-sm">محاضرة حضرت</div>
                        </div>
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-orange-400">4</div>
                            <div class="text-gray-400 text-sm">محاضرة غبت</div>
                        </div>
                        <div class="text-center p-3 rounded-xl bg-white/5">
                            <div class="text-2xl font-bold text-blue-400">2</div>
                            <div class="text-gray-400 text-sm">إجازة</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-4">تفاصيل الحضور حسب المقرر</h2>
                <div class="space-y-4">
                    ${['هياكل البيانات', 'قواعد البيانات', 'برمجة الويب', 'الشبكات', 'الرياضيات'].map((course, i) => {
                        const percentages = [94, 91, 89, 87, 85];
                        const attended = [28, 26, 25, 24, 23];
                        const missed = [2, 3, 3, 4, 4];
                        
                        return `
                            <div class="p-4 rounded-xl bg-white/5">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-medium">${course}</h3>
                                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                                        ${percentages[i]}%
                                    </span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">حضرت: ${attended[i]}</span>
                                    <span class="text-gray-400">غبت: ${missed[i]}</span>
                                    <span class="text-gray-400">إجمالي: ${attended[i] + missed[i]}</span>
                                </div>
                                <div class="mt-2 h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-teal-500" style="width: ${percentages[i]}%"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>
        
        <div class="glass-card rounded-2xl p-6 mt-6">
            <h2 class="text-xl font-bold mb-4">آخر 10 محاضرات</h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-right py-3 px-4">المقرر</th>
                            <th class="text-right py-3 px-4">التاريخ</th>
                            <th class="text-right py-3 px-4">الوقت</th>
                            <th class="text-right py-3 px-4">الحالة</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Array.from({length: 10}).map((_, i) => {
                            const courses = ['هياكل البيانات', 'قواعد البيانات', 'برمجة الويب'];
                            const dates = ['اليوم', 'أمس', '٢٠/١٠', '١٩/١٠', '١٨/١٠'];
                            const times = ['08:00', '10:00', '14:00'];
                            const statuses = ['حاضر', 'حاضر', 'غائب', 'حاضر', 'حاضر', 'إجازة'];
                            
                            const course = courses[i % 3];
                            const date = dates[i % 5];
                            const time = times[i % 3];
                            const status = statuses[i % 6];
                            
                            return `
                                <tr class="border-b border-white/5 hover:bg-white/5">
                                    <td class="py-3 px-4">${course}</td>
                                    <td class="py-3 px-4">${date}</td>
                                    <td class="py-3 px-4">${time}</td>
                                    <td class="py-3 px-4">
                                        <span class="px-2 py-1 rounded-full text-xs ${
                                            status === 'حاضر' ? 'bg-green-500/20 text-green-400' : 
                                            status === 'غائب' ? 'bg-red-500/20 text-red-400' : 
                                            'bg-orange-500/20 text-orange-400'
                                        }">
                                            ${status}
                                        </span>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function contactDoctor(doctorId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">إرسال رسالة للدكتور</h2>
            <p class="text-gray-400">تواصل مع أستاذك</p>
        </div>
        <form onsubmit="sendMessage(event, '${doctorId}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">الموضوع</label>
                    <input type="text" id="message-subject" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" required placeholder="موضوع الرسالة">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">الرسالة</label>
                    <textarea id="message-content" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" rows="5" required placeholder="اكتب رسالتك هنا..."></textarea>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">إرسال</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">إلغاء</button>
            </div>
        </form>
    `;
    showModal(content);
}

function sendMessage(e, doctorId) {
    e.preventDefault();
    showToast('تم إرسال الرسالة بنجاح', 'success');
    hideModal();
}

function viewDoctorSchedule(doctorId) {
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">مواعيد المكتب</h2>
            <p class="text-gray-400">أوقات استقبال الدكتور</p>
        </div>
        
        <div class="space-y-4">
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">الأحد</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        10:00 - 12:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">قاعة 301 - مبنى الكلية</p>
            </div>
            
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">الثلاثاء</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        14:00 - 16:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">قاعة 301 - مبنى الكلية</p>
            </div>
            
            <div class="p-4 rounded-xl bg-white/5">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-medium">الخميس</h3>
                    <span class="px-2 py-1 rounded-full text-xs bg-teal-500/20 text-teal-400">
                        09:00 - 11:00
                    </span>
                </div>
                <p class="text-sm text-gray-400">قاعة 301 - مبنى الكلية</p>
            </div>
        </div>
        
        <div class="mt-6 p-4 rounded-xl bg-blue-500/10 border border-blue-500/20">
            <h3 class="font-medium mb-2">ملاحظات:</h3>
            <ul class="text-sm text-gray-400 space-y-1">
                <li>• يرجى الحضور في الوقت المحدد</li>
                <li>• يمكن حجز موعد مسبق عبر النظام</li>
                <li>• للاستفسارات الطارئة: 555-0123</li>
            </ul>
        </div>
        
        <div class="mt-8">
            <button onclick="hideModal()" class="w-full py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">
                إغلاق
            </button>
        </div>
    `;
    showModal(content);
}

// بعد السطر 450، أضف دالة loadInitialData محدثة لتحميل بيانات إضافية
async function loadInitialData() {
    try {
        // جلب التخصصات من Firebase
        const specsSnapshot = await db.collection('specializations').get();
        const specializations = [];
        specsSnapshot.forEach(doc => {
            specializations.push({
                type: 'specialization',
                __backendId: doc.id,
                ...doc.data()
            });
        });
        
        // جلب المستخدمين
        const usersSnapshot = await db.collection('users').get();
        const users = [];
        usersSnapshot.forEach(doc => {
            users.push({
                type: 'user',
                __backendId: doc.id,
                ...doc.data()
            });
        });
        
        // جلب المجموعات
        const groupsSnapshot = await db.collection('groups').get();
        const groups = [];
        groupsSnapshot.forEach(doc => {
            groups.push({
                type: 'group',
                __backendId: doc.id,
                ...doc.data()
            });
        });
        
        // جلب المقررات
        const coursesSnapshot = await db.collection('courses').get();
        const courses = [];
        coursesSnapshot.forEach(doc => {
            courses.push({
                type: 'course',
                __backendId: doc.id,
                ...doc.data()
            });
        });
        
        // جلب الجداول
        const schedulesSnapshot = await db.collection('schedules').get();
        const schedules = [];
        schedulesSnapshot.forEach(doc => {
            schedules.push({
                type: 'schedule',
                __backendId: doc.id,
                ...doc.data()
            });
        });
        
        // دمج كل البيانات
        allData = [
            ...specializations,
            ...users,
            ...groups,
            ...courses,
            ...schedules
        ];
        
        // بيانات افتراضية للقاعات إذا لم تكن موجودة
        if (!allData.some(d => d.type === 'room')) {
            const defaultRooms = [
                { type: 'room', __backendId: 'room1', name: 'قاعة 101', type: 'lecture', capacity: 50, location: 'المبنى الرئيسي', status: 'available' },
                { type: 'room', __backendId: 'room2', name: 'قاعة 203', type: 'lecture', capacity: 40, location: 'المبنى الرئيسي', status: 'available' },
                { type: 'room', __backendId: 'room3', name: 'معمل 105', type: 'lab', capacity: 30, location: 'مبنى المعامل', equipment: 'حواسيب', status: 'available' },
                { type: 'room', __backendId: 'room4', name: 'قاعة 301', type: 'lecture', capacity: 60, location: 'المبنى الجديد', status: 'available' },
                { type: 'room', __backendId: 'room5', name: 'معمل 205', type: 'lab', capacity: 25, location: 'مبنى المعامل', equipment: 'أجهزة شبكات', status: 'maintenance' }
            ];
            allData.push(...defaultRooms);
        }
        
        updateUI();
        
    } catch (error) {
        console.error("Error loading initial data:", error);
    }
}

// بعد السطر 950، أضف دالة editSpecialization
async function editSpecialization(id) {
    const specialization = allData.find(d => d.type === 'specialization' && d.__backendId === id);
    if (!specialization) return;
    
    const content = `
        <div class="mb-6">
            <h2 class="text-2xl font-bold">تعديل التخصص</h2>
            <p class="text-gray-400">تعديل بيانات التخصص</p>
        </div>
        <form onsubmit="updateSpecialization(event, '${id}')">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">اسم التخصص</label>
                    <input type="text" id="edit-spec-name" class="input-field w-full px-4 py-3 rounded-xl text-white outline-none" value="${specialization.name}" required>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button type="submit" class="btn-primary flex-1 py-3 rounded-xl font-medium">حفظ التغييرات</button>
                <button type="button" onclick="hideModal()" class="flex-1 py-3 rounded-xl bg-gray-500/20 text-gray-400 hover:bg-gray-500/30">إلغاء</button>
            </div>
        </form>
    `;
    showModal(content);
}

async function updateSpecialization(e, id) {
    e.preventDefault();
    const name = document.getElementById('edit-spec-name').value;
    
    try {
        await db.collection('specializations').doc(id).update({
            name: name,
            updated_at: new Date().toISOString()
        });
        
        showToast('تم تحديث التخصص بنجاح');
        hideModal();
        
        // تحديث البيانات المحلية
        const index = allData.findIndex(d => d.type === 'specialization' && d.__backendId === id);
        if (index !== -1) {
            allData[index].name = name;
        }
        
        updateUI();
    } catch (error) {
        console.error("Error updating specialization:", error);
        showToast('فشل في تحديث التخصص', 'error');
    }
}